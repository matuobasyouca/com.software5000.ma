webpackJsonp([6],{185:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(280),i=a.n(s),r=a(6),c=a.n(r),o=a(1);t.default={components:{maining:i.a,maHead:c.a},data:function(){return{isLoading:!0,isEdit:!1}},created:function(){this.isEdit=!a.i(o.c)(a.i(o.f)("id"))}}},186:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(1),i=a(11),r=["employeePage","memberPage","itemPage"],c=["selectEmployeeDatas","handleMemberSearch","selectServiceItem"],o=["workerId","salerId"],n=["workerName","salerName"];t.default={name:"maining",directives:{clickoutside:i.a},props:{value:Boolean},data:function(){return{context:this,isEdit:!1,firstLoad:!1,memberResultVisible:!1,memberDatas:[],memberColumns:[{title:"车牌",key:"carNumber",width:100},{title:"客户姓名",key:"realName",width:126},{title:"手机号",key:"mobile",width:128},{title:"会员等级",width:90,render:function(e){return e.recordId?e.lvlName||"普通会员":"非会员"}}],memberPage:{startPage:1,pageSize:10,total:0},lastMemberSendData:{},memberRecordId:"",memberLvl:"----",memberVisitCount:"--",memberVisitTime:"----",userMobile:"",userNameRemark:"",memberBalance:0,memberBalanceDeduct:0,packageDatas:[],packageRemain:{},itemDatas:[],itemColumns:[{title:"服务项目",width:"160",key:"itemName"},{title:"售价",width:"70",render:function(e){return parseFloat(e.salePrice).toFixed(2)}}],itemSearchKey:"",itemTypes:[],itemType:"",itemPage:{startPage:1,pageSize:10,total:0},tempItemVisible:!1,tempItemName:"",tempItemPrice:"",itemSelectDatas:[],itemSelectColumns:[{title:"已选项目",key:"serviceItemName",width:140},{title:"售价",width:64,render:function(e){return parseFloat(e.salePrice).toFixed(2)}},{title:"数量",width:44,className:"item-times",render:function(e,t,a,s){return e._readonly?'<p @click="handleOpenInsertItemTimes('+a+')">'+s.handleCalcItemTimes(e.itemsTimes)+"</p>":'\n                                <input\n                                    class="item-times"\n                                    type="number"\n                                    autofocus\n                                    onfocus="this.select()"\n                                    value="'+s.handleCalcItemTimes(e.itemsTimes)+'"\n                                    @blur="handleCloseInsertItemTimes('+a+')"\n                                    @change="handleChangeItemTimes('+a+',$event)">'}},{title:"卡券抵扣",width:190,render:function(e,t,i,r){var c=[];return r.couponsData.forEach(function(e){r.isCouponListShow(e,i)&&c.push(e)}),a.i(s.c)(e.couponUuid)?c.length>0?'<p class="ten-cross" @click="handlePopCoupon('+e.itemType+","+i+')"><i></i></p>':"<span>无可用卡券</span>":'<span class="worker-name" @click="handlePopCoupon('+e.itemType+","+i+')">'+e.couponName+" (-"+e.couponDeduct+")</span>"}},{title:"会员扣减",width:66,render:function(e,t,a,s){var i=0,r=(s.handleCalcItemTimes(e.itemsTimes)-(e._useCard?s.handleCalcUsePackageTimes(e,a):0))*e.salePrice-(e.couponDeduct||0);if(1==e.discountType)i=parseFloat((1-e.discountNumber/10)*r).toFixed(2);else if(2==e.discountType){var c=(s.handleCalcItemTimes(e.itemsTimes)-(e._useCard?s.handleCalcUsePackageTimes(e,a):0))*(e.salePrice-e.discountNumber);i=parseFloat(c-r>0?r:c).toFixed(2)}return s.$set(s.itemSelectDatas[a],"discountPrice",parseFloat(i)),"-"+i}},{title:"总金额",width:80,render:function(e,t,a,s){var i=parseFloat((s.handleCalcItemTimes(e.itemsTimes)-(e._useCard?s.handleCalcUsePackageTimes(e,a):0))*e.salePrice-(e.couponDeduct||0)-e.discountPrice).toFixed(2);return s.$set(s.itemSelectDatas[a],"totalPrice",parseFloat(i)),i}},{title:"派工人员",width:80,render:function(e,t,i){return a.i(s.c)(e.workerName)?'<p class="ten-cross" @click="handleAddWorker(0,'+i+')"><i></i></p>':'<span class="worker-name" @click="handleAddWorker(0,'+i+')">'+e.workerName+"</span>"}},{title:"销售人员",width:80,render:function(e,t,i){return a.i(s.c)(e.salerName)?'<p class="ten-cross" @click="handleAddWorker(1,'+i+')"><i></i></p>':'<span class="worker-name" @click="handleAddWorker(1,'+i+')">'+e.salerName+"</span>"}},{title:"操作",width:156,className:"item-control",render:function(e,t,a,s){return(e._hasCard?'\n                            <p class="table-switch-wrap '+(e._useCard?"is-usecard":"")+'"><span class="table-switch" @click="handleToggleUseCard('+a+')"></span>'+(e._useCard?"用卡*"+s.handleCalcUsePackageTimes(e,a):"不用卡")+"</p>":'<p class="table-switch-wrap"></p>')+'<i class="delete-icon" @click="handleDeleteItem('+a+')"></i>'}}],itemIdList:[],carNumSelectVisible:!1,currCarArea:"闽",currCarLetter:"D",currCarNo:"",defaultCarNum:"闽D",carNumArea:["（京）北京","（津）天津","（沪）上海","（渝）重庆","（冀）河北","（豫）河南","（云）云南","（辽）辽宁","（黑）黑龙江","（湘）湖南","（皖）安徽","（鲁）山东","（新）新疆","（苏）江苏","（浙）浙江","（赣）江西","（鄂）湖北","（桂）广西","（甘）甘肃","（晋）山西","（蒙）内蒙古","（陕）陕西","（吉）吉林","（闽）福建","（贵）贵州","（粤）广东","（青）青海","（藏）西藏","（川）四川","（宁）宁夏","（琼）海南"],carNumLetter:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],employeeSelectVisible:!1,employeeDatas:[],employeePage:{startPage:1,pageSize:10,total:0},currItemIndex:"",currItemType:"",currItemWorkerType:"",finalData:{id:"",balanceDeduct:"",totalPrice:"",carNumber:"",workOrderDetails:[],userId:"",user:{realName:""},state:1,mobile:"",businessDeduct:"",materialCost:"",payType:"",comment:""},couponSelectVisible:!1,couponsData:[],couponsItemData:[],couponKey:1}},computed:{addRowspan:function(){var e=0;return this.packageDatas.forEach(function(t){t.remainTimes>0&&e++}),4-(e>3?3:e)},addRowspanArr:function(){var e=[];return e.length=this.addRowspan-1,e},totalPriceBeforeDeduct:function(){var e=0;return this.itemSelectDatas.forEach(function(t){t.totalPrice&&(e+=parseFloat(t.totalPrice))}),e+=parseFloat(this.finalData.materialCost||0),e.toFixed(2)},totalPriceBeforeBalance:function(){var e=this.totalPriceBeforeDeduct-(this.finalData.businessDeduct||0);return parseFloat(e>0?e:0).toFixed(2)},totalPrice:function(){var e=this.totalPriceBeforeBalance-this.memberBalanceDeduct;return parseFloat(e>0?e:0).toFixed(2)}},watch:{tempItemVisible:function(e){e||(this.tempItemName="",this.tempItemPrice="")}},methods:{updateDefaultCar:function(e){var t=this;a.i(s.c)(this.currCarArea)||this.defaultCarNum===""+this.currCarArea+e||(this.currCarLetter=e,this.defaultCarNum=""+this.currCarArea+e,this.carNumSelectVisible=!1,this.$ajax(this.$joggle.merchant.workorder.updateDefaultCar,{defaultCar:this.defaultCarNum},!0,function(e,a){if("ZS011000"===e.code){if(t.currCarNo.length<5)return a.close(),void t.$message({type:"success",message:"设置成功!",duration:1200});t.handleCarNoChange(function(){t.$message({type:"success",message:"设置成功!",duration:1200})})}else a.close(),t.$message({type:"error",message:e.msg,duration:1200})}))},updateWorkOrder:function(){var e=this;this.itemSelectDatas.forEach(function(e){e.usePackageTimes=e._useCard?e.usePackageTimes:0}),this.finalData.workOrderDetails=this.itemSelectDatas,this.finalData.totalPrice=this.totalPrice,this.finalData.businessDeduct=Math.min(parseFloat(this.finalData.businessDeduct||0),parseFloat(this.totalPriceBeforeDeduct)).toFixed(2),this.finalData.materialCost=parseFloat(this.finalData.materialCost||0).toFixed(2),this.finalData.balanceDeduct=Math.min(parseFloat(this.memberBalanceDeduct),parseFloat(this.totalPriceBeforeBalance)).toFixed(2),a.i(s.l)(this.finalData.carNumber)?a.i(s.c)(this.finalData.mobile)||a.i(s.j)(this.finalData.mobile)?0===this.finalData.workOrderDetails.length?this.$message({type:"error",message:"请选择项目!",duration:1200}):this.$ajax(this.$joggle.merchant.workorder.updateWorkOrder,this.finalData,!0,function(t,i){i.close(),"ZS011000"===t.code?(e.$message({type:"success",message:t.msg,duration:1200}),setTimeout(function(){a.i(s.a)("/web/merchant/home/workorder/list_unfinish.html")},1200)):e.$message({type:"error",message:t.msg,duration:1200})}):this.$message({type:"error",message:"请输入正确的手机号码!",duration:1200}):this.$message({type:"error",message:"车牌号码有误!",duration:1200})},selectDefaultCarArea:function(e,t){var i=this;this.$ajax(this.$joggle.merchant.workorder.selectBusinessInfo,{},t,function(t){"ZS011000"===t.code?a.i(s.c)(t.data)||(i.defaultCarNum=t.data.defaultCar||"闽D",i.currCarArea=t.data.defaultCar?t.data.defaultCar[0]:"闽",i.currCarLetter=t.data.defaultCar?t.data.defaultCar[1]:"D"):i.$message({type:"error",message:t.msg,duration:1200}),e&&e()},function(){e&&e()})},selectMemberByCarNumber:function(e,t,i){var r=this,c={startPage:this.memberPage.startPage,pageSize:this.memberPage.pageSize};a.i(s.c)(e)?c=Object.assign({},this.lastMemberSendData,c):this.lastMemberSendData=c=Object.assign({},c,e),this.$ajax(this.$joggle.merchant.workorder.selectMemberByCarNumber,c,i,function(e){"ZS011000"===e.code?(r.memberPage.total=e.data.total,r.memberDatas=e.data.list):r.$message({type:"error",message:e.msg,duration:1200}),t&&t()})},selectWorkOrder:function(e,t,i){var r=this;this.$ajax(this.$joggle.merchant.workorder[a.i(s.c)(i)?"selectWorkOrderByCarNumber":"selectWorkOrderById"],a.i(s.c)(i)?{carNumber:this.finalData.carNumber}:{orderId:i},t,function(t,c){if("ZS011000"===t.code){var o=t.data.workOrder,n=t.data.user,l=a.i(s.c)(n)?"":n.mobile;if(r.itemIdList=t.data.serviceIdList||[],!a.i(s.c)(i)){if(a.i(s.c)(o))return void r.$message({type:"error",message:"工单不存在！",duration:1200});r.finalData.carNumber=a.i(s.c)(o)?"":o.carNumber,r.currCarArea=a.i(s.c)(o)?"闽":o.carNumber[0],r.currCarLetter=a.i(s.c)(o)?"D":o.carNumber[1],r.currCarNo=a.i(s.c)(o)?"":o.carNumber.slice(2)}r.finalData.id=a.i(s.c)(o)?"":o.id,r.finalData.mobile=a.i(s.c)(o)?l:o.mobile,r.finalData.businessDeduct=a.i(s.c)(o)?"":o.businessDeduct||"",r.finalData.materialCost=a.i(s.c)(o)?"":o.materialCost||"",r.finalData.comment=a.i(s.c)(o)?"":o.comment||"",r.userNameRemark=a.i(s.c)(n)?"":n.remarks||"",r.userMobile=l||"",r.finalData.user.realName=a.i(s.c)(n)?"":n.realName,r.finalData.userId=a.i(s.c)(n)?"":n.userId||"",r.memberRecordId=a.i(s.c)(n)?"":n.recordId||"",r.memberLvl=a.i(s.c)(r.memberRecordId)?"非会员":n.lvlName||"普通会员",r.memberVisitCount=a.i(s.c)(n)?"--":n.visitCount||"--",r.memberVisitTime=a.i(s.c)(n)?"----":n.lastVisitTime||"----",r.memberBalanceDeduct=r.memberBalance=a.i(s.c)(n)?0:n.memberBalance||0;var m=r.handlePackageMerge(a.i(s.c)(n)?[]:n.packageList);r.packageDatas=m.packages,r.packageRemain=m.remainTimes;var u=new Promise(function(e){r.selectCouponsByCarNumber(function(){var t=a.i(s.c)(o)?[]:o.workOrderDetails||[];t.forEach(function(e){e._readonly=!0,e._hasCard=e._useCard=!1,(a.i(s.c)(e.itemType)||a.i(s.c)(e.serviceItemId))&&(e.itemType=-1),e._autoCoupon=!0;for(var t in r.packageRemain)if(r.packageRemain[t]>0&&t==e.serviceItemId){e._hasCard=!0,e._useCard=parseInt(e.usePackageTimes||0)>0,r.$set(e,"_autoCoupon",!e._useCard);break}r.$set(e,"couponKey",r.couponKey);var i=!1;a.i(s.c)(e.couponUuid)||(r.couponsData.forEach(function(t){e.couponUuid===t.takeUuid&&(r.$set(t,"couponKey",r.couponKey),i=!0)}),i||(r.$set(e,"couponUuid",""),r.$set(e,"couponName",""),r.$set(e,"couponDeduct",""))),r.couponKey++}),r.itemSelectDatas=t,e()},c)}),p=new Promise(function(e){r.selectServiceItem(function(){e()},c)});Promise.all([u,p]).then(function(){e&&e()})}else c.close(),r.$message({type:"error",message:t.msg,duraton:1200})},function(){r.finalData.id="",r.finalData.totalPrice=0,r.finalData.workOrderDetails=[],r.finalData.userId="",r.finalData.user.realName="",r.finalData.mobile="",r.finalData.businessDeduct="",r.finalData.materialCost="",r.finalData.comment="",r.itemSelectDatas=[],r.memberLvl="",r.memberVisitCount="--",r.memberVisitTime="----",r.packageDatas=[],r.packageRemain={}})},selectCouponsByCarNumber:function(e,t){var a=this;this.$ajax(this.$joggle.merchant.workorder.selectCouponsByCarNumber,{carNumber:this.finalData.carNumber},t,function(t){"ZS011000"===t.code?a.couponsData=t.data:a.$message({type:"error",message:t.msg,duration:1200}),e&&e()})},selectItemType:function(e,t){var a=this;this.$ajax(this.$joggle.mzscp.selectConstantTypes,{codeTypes:"ServiceItemType"},t,function(t){if("ZS011000"===t.code){var s=t.data.ServiceItemType;s.unshift({0:"",1:"全部"}),a.itemTypes=s}else a.$message({type:"error",message:t.msg,duration:1200});e&&e()})},selectServiceItem:function(e,t){var a=this;this.$ajax(this.$joggle.merchant.workorder.selectServiceItem,{startPage:this.itemPage.startPage,pageSize:this.itemPage.pageSize,searchValue:this.itemSearchKey,itemType:this.itemType,userId:this.finalData.userId},t,function(t){"ZS011000"===t.code?(a.itemPage.total=t.data.total,a.itemDatas=t.data.list):a.$message({type:"error",message:t.msg}),e&&e()})},selectEmployeeDatas:function(e,t){var a=this;this.$ajax(this.$joggle.merchant.employee.selectByPage,{startPage:this.employeePage.startPage,pageSize:this.employeePage.pageSize,bossType:2,state:1},t,function(t){"ZS011000"===t.code?(t.data.list.forEach(function(e){a.$set(e,"selected",!1)}),a.employeePage.total=t.data.total,a.employeeDatas=t.data.list):a.$message({type:"error",message:t.msg,duration:1200}),e&&e()})},handleTurnToBuyPackage:function(){a.i(s.a)("/web/merchant/home/member/buy_package.html",{mobile:this.userMobile})},handlePageChange:function(e,t){this[r[e]].startPage=t;var a=this.$loading();"handleMemberSearch"===c[e]?this.selectMemberByCarNumber({},function(){a.close()},a):this[c[e]](function(){a.close()},a)},handleMemberSearch:function(){if(this.finalData.carNumber=""+this.currCarArea+this.currCarLetter+this.currCarNo.toUpperCase(),this.memberPage.total=0,this.memberDatas=[],this.memberResultVisible=!0,this.currCarNo.length>1){this.memberPage.startPage=1;var e={carNumber:this.currCarNo.toUpperCase(),carSelect:""+this.currCarArea+this.currCarLetter};this.selectMemberByCarNumber(e,function(){},!1)}5===this.currCarNo.length&&(this.handleCarNoChange(),this.memberResultVisible=!1)},handleMemberNameSearch:function(){if(this.memberResultVisible=!0,this.memberPage.total=0,this.memberDatas=[],this.finalData.user.realName.length>0){this.memberPage.startPage=1;var e={realName:this.finalData.user.realName};this.selectMemberByCarNumber(e,function(){},!1)}},handleMemeberSelect:function(e){this.currCarArea=e.carNumber[0],this.currCarLetter=e.carNumber[1],this.currCarNo=e.carNumber.slice(2),this.memberResultVisible=!1,this.handleCarNoChange()},handleSetDefaultText:function(e){return this.currCarArea===this.defaultCarNum[0]&&e===this.defaultCarNum[1]?"默认":"设为默认"},handleSetCarLetter:function(e){a.i(s.c)(this.currCarArea)||(this.currCarLetter=e,this.carNumSelectVisible=!1,this.handleCarNoChange())},handleCarNoChange:function(e){if(this.finalData.carNumber=""+this.currCarArea+this.currCarLetter+this.currCarNo.toUpperCase(),7===this.finalData.carNumber.length){if(!a.i(s.l)(this.finalData.carNumber))return void this.$message({type:"error",message:"车牌号码有误!",duration:1200});var t=this.$loading();this.selectWorkOrder(function(){"function"==typeof e&&e(),t.close()},t)}},handlePackageMerge:function(e){var t=[],a={1:0};if(e.length>0)for(var s=0;s<e.length;s++)if(e[s].memberItemUseRecords.length>0)for(var i=e[s].memberItemUseRecords,r=0;r<i.length;r++){var c=!0;t.push({id:i[r].serviceItem.id,itemName:i[r].serviceItem.itemName,remainTimes:i[r].remainTimes,useTimes:i[r].useTimes,validTime:e[s].validTime?e[s].validTime.slice(0,10):"永久"});for(var o in a)if(parseInt(o)===parseInt(i[r].serviceItem.id)){a[o]=parseInt(a[o])+parseInt(i[r].remainTimes),c=!1;break}c&&(a[i[r].serviceItem.id]=i[r].remainTimes)}return{packages:t,remainTimes:a}},handleSelectItemType:function(e){this.itemType=e,this.itemPage.startPage=1;var t=this.$loading();this.selectServiceItem(function(){t.close()},t)},handleItemSearch:function(){this.itemPage.startPage=1,this.selectServiceItem(function(){},!1)},handleEmptyItemSearchKey:function(){this.itemSearchKey="",this.handleItemSearch()},handleItemSelect:function(e){var t=this;if(this.itemIdList.indexOf(e.id)>-1)return void this.$message({type:"error",message:"已有员工创建该项目"});for(var i=!0,r=0;r<this.itemSelectDatas.length;r++)if(e.id===t.itemSelectDatas[r].serviceItemId){i=!1,t.$set(t.itemSelectDatas[r],"itemsTimes",t.itemSelectDatas[r].itemsTimes+1);var c=t.handleChooseMaxCoupon(t.itemSelectDatas[r],t.itemSelectDatas[r].couponKey);!a.i(s.c)(c.takeUuid)&&t.itemSelectDatas[r]._autoCoupon&&(t.$set(t.itemSelectDatas[r],"couponUuid",c.takeUuid),t.$set(t.itemSelectDatas[r],"couponName",c.coupon.cpName),t.$set(t.itemSelectDatas[r],"couponDeduct",c.coupon.cpMoney),t.$set(t.itemSelectDatas[r],"_useCard",!1));break}if(i){var o=this.packageRemain[e.id]&&this.packageRemain[e.id]>0,n=this.couponKey;e._autoCoupon=!0;var l=this.handleChooseMaxCoupon(e,n),m={id:"",serviceItemId:e.id,serviceItemName:e.itemName,itemsTimes:1,usePackageTimes:0,salePrice:e.salePrice,workerId:"",salerId:"",itemType:e.itemType,discountType:e.discountType||"",discountPrice:0,discountNumber:e.discountNumber||(1==e.discountType?10:0),couponKey:n,couponUuid:l.takeUuid||"",couponName:l.coupon?l.coupon.cpName||"":"",couponDeduct:l.coupon?l.coupon.cpMoney||0:0,totalPrice:0,_autoCoupon:!0,_readonly:!0,_hasCard:o,_useCard:o&&a.i(s.c)(l.takeUuid)},u=a.i(s.m)(this.itemSelectDatas);u.push(m),this.itemSelectDatas=u,this.couponKey++}},handleCalcUsePackageTimes:function(e,t){if(e._useCard){var a=[this.handleCalcItemTimes(e.itemsTimes),this.packageRemain?this.packageRemain[e.serviceItemId]||0:0];this.$set(this.itemSelectDatas[t],"usePackageTimes",Math.min.apply(Math,a))}return parseInt(e.usePackageTimes)},handleToggleUseCard:function(e){var t=this,a=this.itemSelectDatas[e];if(this.$set(a,"_useCard",!a._useCard),this.$set(a,"_autoCoupon",!1),a._useCard){this.$set(a,"couponUuid",""),this.$set(a,"couponName",""),this.$set(a,"couponDeduct",0);for(var s=0;s<this.couponsData.length;s++)if(t.couponsData[s].couponKey===a.couponKey){t.$set(t.couponsData[s],"couponKey","");break}}},handleAddWorker:function(e,t){var a=this;this.employeeSelectVisible=!0,this.currItemIndex=t,this.currItemType=this.itemSelectDatas[t].itemType||"-1",this.currItemWorkerType=e,this.employeeDatas.forEach(function(s){a.$set(s,"selected",s.id===a.itemSelectDatas[t][o[e]])})},handleEmployeeSelect:function(e){e.selected?(this.$set(this.itemSelectDatas[this.currItemIndex],o[this.currItemWorkerType],""),this.$set(this.itemSelectDatas[this.currItemIndex],n[this.currItemWorkerType],"")):(this.$set(this.itemSelectDatas[this.currItemIndex],o[this.currItemWorkerType],e.id),this.$set(this.itemSelectDatas[this.currItemIndex],n[this.currItemWorkerType],e.realName)),this.employeeSelectVisible=!1},handleDeleteItem:function(e){for(var t=this,i=0;i<this.couponsData.length;i++)if(t.couponsData[i].couponKey===t.itemSelectDatas[e].couponKey){t.$set(t.couponsData[i],"couponKey","");break}var r=a.i(s.m)(this.itemSelectDatas);this.$delete(r,e),this.itemSelectDatas=r},handleOpenInsertItemTimes:function(e){this.itemSelectDatas[e]._readonly&&this.$set(this.itemSelectDatas[e],"_readonly",!1)},handleCloseInsertItemTimes:function(e){this.$set(this.itemSelectDatas[e],"_readonly",!0)},handleChangeItemTimes:function(e,t){var i=this;this.$set(this.itemSelectDatas[e],"itemsTimes",this.handleCalcItemTimes(t.target.value));var r=this.handleChooseMaxCoupon(this.itemSelectDatas[e],this.itemSelectDatas[e].couponKey);if(!a.i(s.c)(r.takeUuid)&&this.itemSelectDatas[e]._autoCoupon)this.$set(this.itemSelectDatas[e],"couponUuid",r.takeUuid),this.$set(this.itemSelectDatas[e],"couponName",r.coupon.cpName),this.$set(this.itemSelectDatas[e],"couponDeduct",r.coupon.cpMoney),this.$set(this.itemSelectDatas[e],"_useCard",!1);else{this.$set(this.itemSelectDatas[e],"couponUuid",""),this.$set(this.itemSelectDatas[e],"couponName",""),this.$set(this.itemSelectDatas[e],"couponDeduct",0);for(var c=0;c<this.couponsData.length;c++)if(i.couponsData[c].couponKey===i.itemSelectDatas[e].couponKey){i.$set(i.couponsData[c],"couponKey","");break}}},handleCalcItemTimes:function(e){return a.i(s.c)(e)||parseInt(e)<=0?1:parseInt(e)},handleAddTempItem:function(){var e=this,t={tempItemName:"请输入临时项目名称",tempItemPrice:"请输入临时项目价格"};for(var i in t)if(a.i(s.c)(e[i]))return void e.$message({type:"error",message:t[i],duration:1200});for(var r=0;r<this.itemSelectDatas.length;r++)if(e.tempItemName===e.itemSelectDatas[r].serviceItemName)return void e.$message({type:"error",message:"项目名称已存在",duration:1200});var c=this.couponKey,o={itemType:-1,salePrice:parseFloat(this.tempItemPrice).toFixed(2),itemsTimes:1,_autoCoupon:!0},n=this.handleChooseMaxCoupon(o,c),l={id:"",serviceItemId:"",serviceItemName:this.tempItemName,itemsTimes:1,usePackageTimes:0,salePrice:o.salePrice,workerId:"",salerId:"",itemType:-1,discountType:"",discountPrice:0,discountNumber:"",couponKey:c,couponUuid:n.takeUuid||"",couponName:n.coupon?n.coupon.cpName||"":"",couponDeduct:n.coupon?n.coupon.cpMoney||0:0,totalPrice:0,_autoCoupon:!0,_readonly:!0},m=a.i(s.m)(this.itemSelectDatas);m.unshift(l),this.itemSelectDatas=m,this.tempItemVisible=!1,this.couponKey++},handleChooseMaxCoupon:function(e,t){var i=e.itemType,r=e.salePrice*(e.itemsTimes||1),c={coupon:{cpMoney:0}},o=-1;return this.couponsData.forEach(function(t,n){e._autoCoupon&&(a.i(s.c)(t.couponKey)||t.couponKey==e.couponKey)&&(!t.coupon.itemType||i==t.coupon.itemType)&&t.coupon.cpMoney-r<=0&&t.coupon.cpMoney-c.coupon.cpMoney>=0&&(c=t,o=n)}),o>-1?(this.$set(this.couponsData[o],"couponKey",t),this.couponsData[o]):{}},handlePopCoupon:function(e,t){var a=this;if(this.itemSelectDatas[t]._useCard)return void this.$message({type:"warning",message:"已选择使用套餐，不能使用优惠券！"});this.currItemIndex=t,this.currItemType=e||"-1";var s=[];this.couponsData.forEach(function(e,t){a.isCouponListShow(e)&&(e._index=t,s.push(e))}),this.couponsItemData=s,this.couponSelectVisible=!0},isCouponListShow:function(e,t){t=a.i(s.c)(t)?this.currItemIndex:t;var i=this.itemSelectDatas[t];if(a.i(s.c)(i))return!1;var r=i.itemType||-1;return(!e.couponKey||e.couponKey==i.couponKey)&&(!e.coupon.itemType||e.coupon.itemType==r)&&e.coupon.cpMoney-i.itemsTimes*i.salePrice<=0},handleSelectCoupon:function(e){var t=this,a=this.itemSelectDatas[this.currItemIndex];this.$set(a,"_autoCoupon",!1);for(var s=0;s<this.couponsData.length;s++)t.couponsData[s].takeUuid===e&&(t.couponsData[s].couponKey===a.couponKey?(t.$set(t.couponsData[s],"couponKey",""),t.$set(a,"couponUuid",""),t.$set(a,"couponName",""),t.$set(a,"couponDeduct",0)):(t.couponsItemData.forEach(function(e){t.$set(e,"couponKey",""),t.$set(t.couponsData[e._index],"couponKey","")}),t.$set(t.couponsData[s],"couponKey",a.couponKey),t.$set(a,"couponUuid",t.couponsData[s].takeUuid),t.$set(a,"couponName",t.couponsData[s].coupon.cpName),t.$set(a,"couponDeduct",t.couponsData[s].coupon.cpMoney)));this.couponSelectVisible=!1}},mounted:function(){var e=this;this.finalData.id=a.i(s.f)("id")||"",this.isEdit=!a.i(s.c)(this.finalData.id);var t=this.$loading(),i=new Promise(function(i){a.i(s.c)(e.finalData.id)?i():e.selectWorkOrder(function(){i()},t,e.finalData.id)}),r=new Promise(function(a){e.selectEmployeeDatas(function(){a()},t)}),c=new Promise(function(i){a.i(s.c)(e.finalData.id)?e.selectDefaultCarArea(function(){i()},t):i()}),o=new Promise(function(a){e.selectServiceItem(function(){a()},t)}),n=new Promise(function(a){e.selectItemType(function(){a()},t)});Promise.all([i,r,c,o,n]).then(function(){e.$emit("input",!1),t.close()})}}},279:function(e,t,a){function s(e){a(394)}var i=a(0)(a(185),a(302),s,null,null);e.exports=i.exports},280:function(e,t,a){function s(e){a(383)}var i=a(0)(a(186),a(288),s,null,null);e.exports=i.exports},288:function(e,t){e.exports={render:function(){var e=this,t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"page-main"},[s("div",{staticClass:"page-left"},[s("div",{staticClass:"page-left-top"},[s("div",{staticClass:"page-block-1",class:[{"is-edit":t.isEdit}]},[s("ul",{staticClass:"block-1-list"},[s("li",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:function(t){e.memberResultVisible=!1},expression:"_=>{this.memberResultVisible = false}"}],staticClass:"block-input-wrap required car-number-input"},[s("zs-icon",{staticClass:"block-input-label",attrs:{"right-icon":t.isEdit?"":"caret-bottom",text:t.currCarArea+" "+t.currCarLetter},on:{click:function(e){!t.isEdit&&(t.carNumSelectVisible=!0)}}}),t._v(" "),s("zs-input",{attrs:{placeholder:"请输入车牌",readonly:t.isEdit,autofocus:"",maxlength:5},on:{change:t.handleMemberSearch},model:{value:t.currCarNo,callback:function(e){t.currCarNo="string"==typeof e?e.trim():e},expression:"currCarNo"}}),t._v(" "),t.isEdit?t._e():s("zs-icon",{staticClass:"search-label",class:[{"is-open":t.memberResultVisible}],attrs:{icon:t.memberResultVisible?"user2":"user1",size:"18",icon2:"arrow-"+(t.memberResultVisible?"top":"bottom"),size2:"8","icon-dis":"6"},on:{click:function(e){t.memberResultVisible=!t.memberResultVisible}}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.memberResultVisible,expression:"memberResultVisible"}],staticClass:"search-result"},[s("zs-table",{attrs:{data:t.memberDatas,columns:t.memberColumns,context:t.context,"no-data-colspan":4,"no-data-text":"暂无客户","no-data-icon":"data-empty-member",border:""},on:{"on-row-click":t.handleMemeberSelect}}),t._v(" "),s("zs-pagination",{attrs:{current:this.memberPage.startPage,total:this.memberPage.total,"page-size":this.memberPage.pageSize,simple:""},on:{"on-change":function(e){t.handlePageChange(1,e)}}})],1)],1),t._v(" "),s("li",{staticClass:"block-input-wrap user-name"},[s("span",{staticClass:"block-input-label"},[t._v("姓名")]),t._v(" "),s("zs-input",{ref:"carNumberInput",attrs:{placeholder:"请输入姓名"},on:{change:t.handleMemberNameSearch},model:{value:t.finalData.user.realName,callback:function(e){t.finalData.user.realName=e},expression:"finalData.user.realName"}}),t._v(" "),s("span",{staticClass:"user-name-remark"},[t._v(t._s(t.userNameRemark?"("+t.userNameRemark+")":""))])],1),t._v(" "),s("li",{staticClass:"block-input-wrap pl10"},[s("span",{staticClass:"total-income"},[t._v("总到店:"+t._s(t.memberVisitCount||"")+"次")]),t._v(" "),s("span",[t._v("上次到店: "+t._s(t.memberVisitTime?t.memberVisitTime.slice(0,10):""))])]),t._v(" "),s("li",{staticClass:"block-input-wrap"},[s("span",{staticClass:"block-input-label"},[t._v("手机号")]),t._v(" "),s("zs-input",{attrs:{placeholder:"请输手机号",maxlength:11},model:{value:t.finalData.mobile,callback:function(e){t.finalData.mobile=e},expression:"finalData.mobile"}})],1),t._v(" "),s("li",{staticClass:"block-input-wrap"},[s("span",{staticClass:"block-input-label"},[t._v("欠款")]),t._v(" "),s("zs-input",{attrs:{value:"0",disabled:"",placeholder:"请输入欠款金额"}})],1),t._v(" "),s("li",{staticClass:"block-input-wrap pl66"},[s("span",{staticClass:"block-input-label"},[t._v("会员等级")]),t._v(" "),s("p",{staticClass:"pl12"},[t._v(t._s(t.memberLvl))])])]),t._v(" "),s("div",{staticClass:"block-1-remark"},[s("span",[t._v("备注")]),t._v(" "),s("zs-input",{attrs:{icon:"circle-cross",placeholder:"请输入备注"},model:{value:t.finalData.comment,callback:function(e){t.finalData.comment=e},expression:"finalData.comment"}})],1)]),t._v(" "),s("div",{staticClass:"page-block-2"},[t._m(0),t._v(" "),s("div",{staticClass:"block-2-package-body"},[s("zs-scrollbar",{attrs:{"wrap-class":"package-select-scrollbar"}},[s("table",[s("colgroup",[s("col",{attrs:{width:"150"}}),t._v(" "),s("col",{attrs:{width:"68"}}),t._v(" "),s("col",{attrs:{width:"68"}}),t._v(" "),s("col",{attrs:{width:"82"}})]),t._v(" "),t._l(t.packageDatas,function(e){return e.remainTimes>0?s("tr",{key:e.id},[s("td",[s("div",{staticClass:"table-cell"},[t._v(t._s(e.itemName))])]),t._v(" "),s("td",[s("div",{staticClass:"table-cell"},[t._v(t._s(e.remainTimes))])]),t._v(" "),s("td",[s("div",{staticClass:"table-cell"},[t._v(t._s(e.useTimes-e.remainTimes))])]),t._v(" "),s("td",[s("div",{staticClass:"table-cell"},[t._v(t._s(e.validTime))])])]):t._e()})],2)])],1),t._v(" "),s("table",[s("tr",[s("td",{staticClass:"block-2-add",attrs:{colspan:"4",rowspan:t.addRowspan}},[s("zs-button",{attrs:{type:"primary"},on:{click:t.handleTurnToBuyPackage}},[t._v("购买套餐\n                            ")])],1)]),t._v(" "),t._l(t.addRowspanArr,function(e,t){return s("tr",{key:t})})],2)])]),t._v(" "),s("div",{staticClass:"page-left-bottom"},[s("div",{staticClass:"page-block-3"},[s("zs-table",{attrs:{data:t.itemSelectDatas,columns:t.itemSelectColumns,context:t.context,"no-data-colspan":9,border:""}}),t._v(" "),s("div",{staticClass:"add-new-item"},[s("zs-icon",{attrs:{icon:"ten-cross",size:"10",text:"添加临时项目"},on:{click:function(e){t.tempItemVisible=!0}}})],1)],1),t._v(" "),s("div",{staticClass:"page-block-4"},[s("div",{staticClass:"block-4-inner"},[s("div",{staticClass:"block-input-wrap"},[s("span",{staticClass:"block-input-label"},[t._v("附加费用")]),t._v(" "),s("zs-input",{attrs:{type:"number","auto-select":0==t.finalData.materialCost,placeholder:"请输入附加费用"},model:{value:t.finalData.materialCost,callback:function(e){t.finalData.materialCost=e},expression:"finalData.materialCost"}})],1),t._v(" "),s("div",{staticClass:"block-input-wrap"},[s("span",{staticClass:"block-input-label"},[t._v("商家扣减")]),t._v(" "),s("zs-input",{attrs:{type:"number","auto-select":0==t.finalData.businessDeduct,placeholder:"请输入扣减金额"},model:{value:t.finalData.businessDeduct,callback:function(e){t.finalData.businessDeduct=e},expression:"finalData.businessDeduct"}})],1),t._v(" "),t.memberBalance>0?s("div",{staticClass:"block-input-wrap member-balance"},[s("zs-checkbox",{attrs:{"true-label":t.memberBalance,"false-label":0},model:{value:t.memberBalanceDeduct,callback:function(e){t.memberBalanceDeduct=e},expression:"memberBalanceDeduct"}},[t._v("会员余额支付 "),s("i",[t._v("(余额:"+t._s(parseFloat(t.memberBalance).toFixed(2))+")")])])],1):t._e(),t._v(" "),s("span",{staticClass:"block-4-summary"},[t._v("合计费用："),s("i",[t._v("￥"+t._s(t.totalPrice))])]),t._v(" "),s("div",{staticClass:"block-4-btn",on:{click:t.updateWorkOrder}},[t._v("提交工单")])])])])]),t._v(" "),s("div",{staticClass:"page-right"},[s("p",{staticClass:"block-5-title"},[t._v("可选项目")]),t._v(" "),s("div",{staticClass:"search-wrapper"},[s("zs-input",{attrs:{icon:"circle-cross",placeholder:"请输入服务项目关键词进行搜索"},on:{"on-icon-click":t.handleEmptyItemSearchKey,change:t.handleItemSearch},model:{value:t.itemSearchKey,callback:function(e){t.itemSearchKey="string"==typeof e?e.trim():e},expression:"itemSearchKey"}})],1),t._v(" "),s("div",{staticClass:"block-5-item"},[s("dl",{staticClass:"block-5-menu"},[s("dt",[t._v("项目分类")]),t._v(" "),t._l(t.itemTypes,function(e){return s("dd",{key:e[0],class:[{curr:e[0]===t.itemType}],on:{click:function(a){t.handleSelectItemType(e[0])}}},[t._v(t._s(e[1])+"\n                ")])})],2),t._v(" "),s("div",{staticClass:"block-5-main"},[s("zs-table",{attrs:{data:t.itemDatas,columns:t.itemColumns,context:t.context,"no-data-colspan":2,border:""},on:{"on-row-click":t.handleItemSelect}}),t._v(" "),t.itemDatas.length>0?s("div",{staticClass:"pagination-wrap"},[s("zs-pagination",{attrs:{current:t.itemPage.startPage,total:t.itemPage.total,"page-size":t.itemPage.pageSize,simple:""},on:{"on-change":function(e){t.handlePageChange(2,e)}}}),t._v(" "),s("span",{staticClass:"item-total"},[t._v("共 "+t._s(t.itemPage.total)+" 条")])],1):t._e()],1)])]),t._v(" "),s("zs-dialog",{staticClass:"carnum-select-pop",model:{value:t.carNumSelectVisible,callback:function(e){t.carNumSelectVisible=e},expression:"carNumSelectVisible"}},[s("p",{slot:"title"},[t._v("选择车牌地区")]),t._v(" "),s("div",{staticClass:"carnum-area-list"},[s("zs-scrollbar",{attrs:{"wrap-class":"carnum-select-scrollbar"}},t._l(t.carNumArea,function(e,a){return s("p",{key:a,staticClass:"list",class:[{curr:t.currCarArea===e[1]}],on:{click:function(a){t.currCarArea=e[1]}}},[t._v(t._s(e)+"\n                ")])}))],1),t._v(" "),s("div",{staticClass:"carnum-area-letter"},[s("zs-scrollbar",{attrs:{"wrap-class":"carnum-select-scrollbar"}},t._l(t.carNumLetter,function(e,a){return s("div",{key:a,staticClass:"list",class:[{curr:t.currCarLetter===e,disabled:!t.currCarArea}]},[s("p",{on:{click:function(a){t.handleSetCarLetter(e)}}},[t._v(t._s(t.currCarArea+" "+e))]),t._v(" "),s("p",{staticClass:"default-btn",on:{click:function(a){t.updateDefaultCar(e)}}},[t._v(t._s(t.handleSetDefaultText(e)))])])}))],1)]),t._v(" "),s("zs-dialog",{staticClass:"temp-item-pop",model:{value:t.tempItemVisible,callback:function(e){t.tempItemVisible=e},expression:"tempItemVisible"}},[s("p",{slot:"title"},[t._v("新建临时项目")]),t._v(" "),s("zs-form",{attrs:{"label-position":"right","label-width":"100px"}},[s("zs-form-item",{staticClass:"temp-item-name",attrs:{label:"项目名称",required:""}},[s("zs-input",{attrs:{placeholder:"请输入服务项目名称",maxlength:10},model:{value:t.tempItemName,callback:function(e){t.tempItemName=e},expression:"tempItemName"}}),t._v(" "),s("span",{staticClass:"length-count"},[t._v(t._s(t.tempItemName.length)+"/10")])],1),t._v(" "),s("zs-form-item",{attrs:{label:"项目价格",required:""}},[s("zs-input",{attrs:{type:"number",placeholder:"请输入服务项目价格"},model:{value:t.tempItemPrice,callback:function(e){t.tempItemPrice=e},expression:"tempItemPrice"}})],1)],1),t._v(" "),s("template",{slot:"footer"},[s("zs-button",{attrs:{type:"cancel"},on:{click:function(e){t.tempItemVisible=!1}}},[t._v("取消\n            ")]),t._v(" "),s("zs-button",{attrs:{type:"primary"},on:{click:t.handleAddTempItem}},[t._v("确定\n            ")])],1)],2),t._v(" "),s("zs-dialog",{staticClass:"select-pop",model:{value:t.employeeSelectVisible,callback:function(e){t.employeeSelectVisible=e},expression:"employeeSelectVisible"}},[s("p",{slot:"title"},[t._v("选择员工")]),t._v(" "),s("ul",{staticClass:"employee-select-list"},[s("li",{staticClass:"employee-select-hd"},[s("span",[t._v("选择")]),s("span",[t._v("员工姓名")])]),t._v(" "),t.employeeDatas.length>0?t._l(t.employeeDatas,function(e){return s("li",{key:e.id,on:{click:function(a){t.handleEmployeeSelect(e)}}},[s("span",[s("i",{staticClass:"table-radio",class:[{curr:e.selected}]})]),t._v(" "),s("span",[t._v(t._s(e.realName))])])}):s("li",{staticClass:"employee-empty"},[s("p",[t._v("暂无员工")])])],2),t._v(" "),t.employeeDatas.length>0?s("zs-pagination",{attrs:{current:t.employeePage.startPage,total:t.employeePage.total,"page-size":t.employeePage.pageSize,"show-total":""},on:{"on-change":function(e){t.handlePageChange(0,e)}},slot:"footer"}):t._e()],1),t._v(" "),s("zs-dialog",{staticClass:"select-pop coupon-select-pop",model:{value:t.couponSelectVisible,callback:function(e){t.couponSelectVisible=e},expression:"couponSelectVisible"}},[s("p",{slot:"title"},[t._v("选择优惠券")]),t._v(" "),s("ul",{staticClass:"employee-select-list"},[s("li",{staticClass:"employee-select-hd"},[s("span",[t._v("选择")]),s("span",[t._v("优惠券名称")]),s("span",[t._v("优惠券金额")])]),t._v(" "),t.couponsItemData.length>0?t._l(t.couponsItemData,function(e,a){return t.isCouponListShow(e)?s("li",{key:e.id,on:{click:function(a){t.handleSelectCoupon(e.takeUuid)}}},[s("span",[s("i",{staticClass:"table-radio",class:[{curr:e.couponKey===t.itemSelectDatas[t.currItemIndex].couponKey}]})]),t._v(" "),s("span",[t._v(t._s(e.coupon.cpName))]),t._v(" "),s("span",[t._v(t._s(e.coupon.cpMoney))])]):t._e()}):s("li",{staticClass:"employee-empty"},[s("p",[t._v("暂无可用优惠券")])])],2)])],1)},staticRenderFns:[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("table",[a("colgroup",[a("col",{attrs:{width:"150"}}),e._v(" "),a("col",{attrs:{width:"68"}}),e._v(" "),a("col",{attrs:{width:"68"}}),e._v(" "),a("col",{attrs:{width:"82"}})]),e._v(" "),a("tr",{staticClass:"table-head"},[a("th",[a("div",{staticClass:"table-cell"},[e._v("套餐项目")])]),e._v(" "),a("th",[a("div",{staticClass:"table-cell"},[e._v("剩余次数")])]),e._v(" "),a("th",[a("div",{staticClass:"table-cell"},[e._v("消费次数")])]),e._v(" "),a("th",[a("div",{staticClass:"table-cell"},[e._v("到期时间")])])])])}]}},302:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"workorder-page"},[a("ma-head",{attrs:{"curr-id":"02"}}),e._v(" "),a("zs-breadcrumb",{attrs:{separator:"arrow-right"}},[a("zs-breadcrumb-item",{attrs:{to:e.isEdit?"/web/merchant/home/workorder/list_unfinish.html":""}},[e._v(e._s(e.isEdit?"未完成工单":"快捷开单"))]),e._v(" "),e.isEdit?a("zs-breadcrumb-item",[e._v("修改工单")]):e._e()],1),e._v(" "),a("maining",{tag:"component",model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}})],1)},staticRenderFns:[]}},383:function(e,t){},394:function(e,t){},473:function(e,t,a){e.exports=a(63)},63:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2),i=a(279),r=a.n(i),c=a(5),o=(a.n(c),a(3),a(4));s.a.use(o.a),new s.a({el:"#app",render:function(e){return e(r.a)}})}},[473]);