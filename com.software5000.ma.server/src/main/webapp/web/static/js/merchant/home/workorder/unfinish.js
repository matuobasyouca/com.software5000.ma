webpackJsonp([9],{181:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(277),s=r.n(a),n=r(6),o=r.n(n);t.default={components:{maining:s.a,maHead:o.a},data:function(){return{isLoading:!0}}}},182:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(1);t.default={name:"maining",data:function(){return{context:this,currOrderId:"",currCarNumber:"",orderDatas:[],orderColumns:[{title:"工单编号",key:"orderNo",width:146},{title:"车牌号码",key:"carNumber",width:90},{title:"手机号",width:108,render:function(e){return e.mobile||"----"}},{title:"客户姓名",width:100,render:function(e){return e.realName||"--"}},{title:"开单时间",key:"createTime",width:146},{title:"操作",width:110,className:"table-control",render:function(e){return'<a @click.stop="handleEdit('+e.id+')">编辑</a><a @click.stop="handleOrderDel('+e.id+')">删除</a>'}}],orderPage:{startPage:1,pageSize:10,total:0},itemDatas:[],itemColumns:[{title:"服务项目",key:"serviceItemName",width:144},{title:"数量",key:"itemsTimes",width:80},{title:"单价",width:80,render:function(e){return parseFloat(e.salePrice).toFixed(2)}},{title:"施工人员",width:100,render:function(e){return e.workerName||"/"}},{title:"操作",width:114,className:"table-control",render:function(e,t,r){return'<a @click.stop="handleItemDel('+e.id+","+r+')">删除</a>'}}]}},methods:{handlePageChange:function(e){this.orderPage.startPage=e;var t=this.$loading();this.selectWorkOrder(function(){t.close()},t)},handlePageSizeChagne:function(e){this.orderPage.pageSize=e;var t=this.$loading();this.selectWorkOrder(function(){t.close()},t)},selectWorkOrder:function(e,t){var r=this;this.$ajax(this.$joggle.merchant.workorder.selectWorkOrderByPage,{state:1,startPage:this.orderPage.startPage,pageSize:this.orderPage.pageSize},t,function(t){if("ZS011000"===t.code){r.orderPage.total=t.data.total;var a=t.data.list;a.length>0&&(r.$set(a[0],"_highlight",!0),r.currOrderId=a[0].id,r.currCarNumber=a[0].carNumber),r.orderDatas=a,e&&e(a)}else r.$message({type:"error",message:t.msg,duration:1200})})},handleEdit:function(e){r.i(a.c)("/web/merchant/home/workorder/manage.html",{id:e})},handleOrderDel:function(e){var t=this;this.$confirm({title:"删除",type:"delete",message:"确认删除该工单?"}).then(function(){t.$ajax(t.$joggle.merchant.workorder.deleteWorkOrderById,{orderId:e},!0,function(e,r){"ZS011000"===e.code?(1===t.orderDatas.length&&t.orderPage.startPage>1&&(t.orderPage.startPage-=1),t.selectWorkOrder(function(e){e.length>0?t.selectItems(function(){t.$message({type:"success",message:"删除成功!",duration:1200}),r.close()},r):(t.itemDatas=[],t.$message({type:"success",message:"删除成功!",duration:1200}),r.close())},r)):(r.close(),t.$message({type:"error",message:e.msg,duration:1200}))})}).catch(function(){})},handleOrderSelect:function(e){this.currOrderId=e.id,this.currCarNumber=e.carNumber;var t=this.$loading();this.selectItems(function(){t.close()},t)},selectItems:function(e,t){var r=this;this.$ajax(this.$joggle.merchant.workorder.selectWorkOrderById,{orderId:this.currOrderId},t,function(t){"ZS011000"===t.code?r.itemDatas=t.data.workOrder.workOrderDetails:r.$message({type:"error",message:t.msg,duration:1200}),e&&e()})},handleItemDel:function(e,t){var s=this;this.$confirm({title:"删除",type:"delete",message:1===this.itemDatas.length?"最后一个项目删除后该工单将被删除,确认删除?":"确认删除该施工项目"}).then(function(){s.$ajax(s.$joggle.merchant.workorder.deleteItemById,{orderId:s.currOrderId,detailId:e},!0,function(e,n){if("ZS011000"===e.code)if(1===s.itemDatas.length)1===s.orderDatas.length&&s.orderPage.startPage>1&&(s.orderPage.startPage-=1),s.selectWorkOrder(function(e){e.length>0?s.selectItems(function(){s.$message({type:"success",message:"删除成功!",duration:1200}),n.close()},n):(s.itemDatas=[],s.$message({type:"success",message:"删除成功!",duration:1200}),n.close())},n);else{var o=r.i(a.k)(s.itemDatas);s.$delete(o,t),s.itemDatas=o,n.close(),s.$message({type:"success",message:"删除成功!",duration:1200})}else n.close(),s.$message({type:"error",message:e.msg,duration:1200})})}).catch(function(){})},handleSetFinish:function(){var e=this;this.$ajax(this.$joggle.merchant.workorder.updateWorkOrderForFinish,{orderId:this.currOrderId},!0,function(t,s){s.close(),"ZS011000"===t.code?(e.$message({type:"success",message:"施工完成",duration:1200}),setTimeout(function(){r.i(a.c)("/web/merchant/home/workorder/balance_submit.html",{id:e.currOrderId})},1200)):(s.close(),e.$message({type:"error",message:t.msg,duration:1200}))})}},created:function(){var e=this,t=this.$loading();this.selectWorkOrder(function(r){r.length>0?e.selectItems(function(){t.close(),e.$emit("input",!1)},t):(t.close(),e.$emit("input",!1))},t)}}},276:function(e,t,r){function a(e){r(422)}var s=r(0)(r(181),r(341),a,null,null);e.exports=s.exports},277:function(e,t,r){function a(e){r(400)}var s=r(0)(r(182),r(306),a,null,null);e.exports=s.exports},306:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page-main"},[r("div",{staticClass:"page-left"},[r("zs-table",{attrs:{data:e.orderDatas,columns:e.orderColumns,context:e.context,"no-data-colspan":6,"highlight-row":"","no-data-text":"暂无工单",border:""},on:{"on-row-click":e.handleOrderSelect}}),e._v(" "),e.orderDatas.length>0?r("zs-pagination",{attrs:{current:e.orderPage.startPage,total:e.orderPage.total,"page-size":e.orderPage.pageSize,"show-total":"","show-elevator":"","show-sizer":""},on:{"on-change":e.handlePageChange,"on-page-size-change":e.handlePageSizeChagne},slot:"footer"}):e._e()],1),e._v(" "),r("div",{staticClass:"page-right"},[r("zs-table",{attrs:{data:e.itemDatas,columns:e.itemColumns,context:e.context,"no-data-colspan":5,"no-data-text":"暂无服务项目",border:""}}),e._v(" "),e.itemDatas.length>0?r("zs-button",{attrs:{type:"success"},on:{click:e.handleSetFinish}},[e._v("施工完成")]):e._e()],1)])},staticRenderFns:[]}},341:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"workorder-page"},[r("ma-head",{attrs:{"curr-id":"02"}}),e._v(" "),r("zs-breadcrumb",{attrs:{separator:"arrow-right"}},[r("zs-breadcrumb-item",[e._v("未完工工单")])],1),e._v(" "),r("maining",{tag:"component",model:{value:e.isLoading,callback:function(t){e.isLoading=t},expression:"isLoading"}})],1)},staticRenderFns:[]}},400:function(e,t){},422:function(e,t){},475:function(e,t,r){e.exports=r(63)},63:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r(2),s=r(276),n=r.n(s),o=r(4),i=(r.n(o),r(5),r(3));a.a.use(i.a),new a.a({el:"#app",render:function(e){return e(n.a)}})}},[475]);