webpackJsonp([26],{174:function(e,s,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t=a(2),i=a(6),r=a.n(i);s.default={components:{maHead:r.a},props:{},data:function(){return{isLoading:!0,recordId:"",currTab:1,classTab:1,tabs:[{title:"消费记录"},{title:"客户信息"}],updateFlag:!0,member:{user:{}},memberLvlList:[],userId:"",realNameVisible:!1,realName:"",mobileVisible:!1,mobile:"",memberLvlId:"",memberLv:"",remarkVisible:!1,remarks:"",packages:[],isOperator:!1,workOrders:[],startPage:1,pageSize:10,total:"",searchKey:"",hasNextPage:!1}},computed:{},watch:{remarkVisible:function(e){e&&(this.remarks=this.member.remarks)}},methods:{updateEditMobile:function(){var e=this;this.$ajax(this.$joggle.merchant.member.updateMemberInfo,{userId:this.userId,mobile:this.mobile},!0,function(s,a){a.close(),"ZS011000"===s.code?(e.mobileVisible=!1,e.member.user.mobile=e.mobile):e.$message({type:"error",message:s.msg})})},updateEditMemberLvl:function(){var e=this;if(!this.member.user.mobile)return this.$message({type:"error",message:"请先填写手机号"}),!1;this.$ajax(this.$joggle.merchant.member.updateMemberInfo,{memberLvlRecordId:this.recordId,memberLvlId:this.memberLvlId},!0,function(s,a){a.close(),"ZS011000"===s.code?e.selectData():e.$message({type:"error",message:s.msg})})},updateEditRemark:function(){var e=this;this.$ajax(this.$joggle.merchant.member.updateMemberInfo,{memberLvlRecordId:this.recordId,remarks:this.remarks},!0,function(s,a){a.close(),"ZS011000"===s.code?(e.remarkVisible=!1,e.member.remarks=e.remarks,e.$message({type:"successs",message:"操作成功"})):e.$message({type:"error",message:s.msg})})},selectData:function(){var e=this;this.$ajax(this.$joggle.merchant.member.selectMemberDetailInfo,{memberLvlRecordId:this.recordId},!0,function(s,a){a.close(),"ZS011000"===s.code?(e.member=s.data,e.userId=e.member.userId,e.realName=e.member.user.realName?e.member.user.realName:"",e.mobile=e.member.user.mobile?e.member.user.mobile:"",e.memberLvlId=e.member.memberLvlId,e.selectMemberPackages(),e.selectPayList(function(){},!1),e.member.user.wxOpenId&&(e.updateFlag=!1)):e.$message({type:"error",message:s.msg}),setTimeout(function(){e.isLoading=!1},100)})},selectMemberPackages:function(){var e=this;this.$ajax(this.$joggle.merchant.member.selectMemberBusinessPackage,{userId:this.userId},!0,function(s,a){if(a.close(),"ZS011000"===s.code){var t=[];s.data.forEach(function(e){e.showAll=!1,t.push(e)}),e.packages=t}else e.$message({type:"error",message:s.msg})})},selectMemberLvlList:function(){var e=this;this.$ajax(this.$joggle.business.selectMemberLvlList,{pageSize:500,state:1},!0,function(s,a){a.close(),"ZS011000"===s.code?e.memberLvlList=s.data.list:e.$message({type:"error",message:s.msg})})},selectPayList:function(e,s){var a=this;s?this.startPage++:this.startPage=1,this.$ajax(this.$joggle.merchant.workorder.selectWorkOrderByPage,{state:"4",startPage:this.startPage,pageSize:this.pageSize,userId:this.userId,searchKey:this.searchKey},!0,function(t,i){i.close(),"ZS011000"===t.code?(a.hasNextPage=t.data.hasNextPage,a.total=t.data.total,a.workOrders=s?a.workOrders.concat(t.data.list):t.data.list):a.$message({type:"error",message:t.msg}),e&&e()})},handleGoHome:function(){a.i(t.d)("/wap/merchant/home/manage/index.html")},handleBuyPackage:function(){a.i(t.d)("/wap/merchant/home/member/buy_package.html",{mobile:this.mobile})},handleGoCar:function(){if(!this.member.user.mobile)return this.$message({type:"error",message:"请先填写手机号"}),!1;a.i(t.d)("/wap/merchant/home/member/bing_car.html",{recordId:this.recordId})},handleRealNameDialog:function(){this.updateFlag&&(this.realNameVisible=!0)},handleEditRealName:function(){var e=this;return a.i(t.c)(this.realName)?(this.$message({type:"error",message:"请输入姓名"}),!1):a.i(t.p)(this.realName)?void this.$ajax(this.$joggle.merchant.member.updateMemberInfo,{userId:this.userId,realName:this.realName},!0,function(s,a){a.close(),"ZS011000"===s.code?(e.realNameVisible=!1,e.member.user.realName=e.realName):e.$message({type:"error",message:s.msg})}):(this.$message({type:"error",message:"姓名只能输入数字、字母或汉字"}),!1)},handleopenMobileDialog:function(){this.updateFlag&&(this.mobileVisible=!0)},handleEditMobile:function(){var e=this;return a.i(t.c)(this.mobile)?(this.$message({type:"error",message:"请输入手机号"}),!1):a.i(t.i)(this.mobile)?void(this.member.user.mobile!==this.mobile&&this.$ajax(this.$joggle.merchant.member.selectCarNumber,{mobile:this.mobile,carNumber:this.member.user.cars[0].carNumber.toUpperCase()},!0,function(s,a){a.close(),"ZS011000"===s.code?e.updateEditMobile():e.$message({type:"error",message:"该手机号已经存在"})})):(this.$message({type:"error",message:"请输入正确的手机号"}),!1)},handleValidate:function(e,s){if(a.i(t.c)(s))return"永久";var i=e.replace(/\D+/g,",").split(",");return s.replace(/\D+/g,",").split(",")[0]-i[0]+"年"},handleCheck:function(e){a.i(t.d)("/wap/merchant/home/workorder/detail.html",{id:e})},handleShowMore:function(){this.hasNextPage&&(this.pageSize=10,this.selectPayList(function(){},!0))},handlePayTime:function(e){return"购买时间："+e.createTime.slice(0,10)},handleValidTime:function(e){var s="永久";return e.businessPackage&&e.businessPackage.validTerm&&e.businessPackage.validTerm>0&&(s=e.businessPackage.validTerm+"年"),"有效期："+s},handleListState:function(e){var s="",a=0,i=(new Date).getTime(),r=e.validTime?t.g.dateToRegular(e.validTime).getTime():"",l=e.memberItemUseRecords;for(var o in l)a+=l[o].remainTimes;return 0===a?s="use-up":r&&i>r&&(s="time-out"),s}},created:function(){this.recordId=a.i(t.a)("id"),this.selectData(),this.selectMemberLvlList()},mounted:function(){}}},249:function(e,s,a){a(351);var t=a(0)(a(174),a(274),null,null);e.exports=t.exports},274:function(e,s){e.exports={render:function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"member-info"},[a("ma-head",{attrs:{rightIconText:"办理套餐"},on:{"home-click":e.handleGoHome,"right-icon-click":e.handleBuyPackage}},[e._v("客户详情")]),e._v(" "),a("zs-tab",{attrs:{tabs:e.tabs},model:{value:e.currTab,callback:function(s){e.currTab=s},expression:"currTab"}}),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:2==e.currTab,expression:"currTab==2"}],staticClass:"member-info-1"},[a("div",{staticClass:"member-detail"},[a("ul",[a("li",{class:{"arrow-right":e.updateFlag},on:{click:e.handleRealNameDialog}},[a("zs-icon",{attrs:{icon:"user",text:"姓名",size:"14"}}),e._v("\n                    "+e._s(e.member.user.realName)+"\n                ")],1),e._v(" "),a("li",{class:{"arrow-right":e.updateFlag},on:{click:e.handleopenMobileDialog}},[a("zs-icon",{attrs:{icon:"mobile",text:"手机号",size:"14"}}),e._v("\n                    "+e._s(e.member.user.mobile)+"\n                ")],1),e._v(" "),a("li",{staticClass:"arrow-right",on:{click:function(s){e.remarkVisible=!0}}},[a("zs-icon",{attrs:{icon:"remark",text:"客户备注",size:"14"}}),e._v("\n                    "+e._s(e.member.remarks)+"\n                ")],1),e._v(" "),a("li",[a("zs-icon",{attrs:{icon:"money",text:"会员余额",size:"14"}}),e._v("\n                    "+e._s(e.member.memberBalance||0)+"\n                ")],1),e._v(" "),a("li",{staticClass:"arrow-right"},[a("zs-icon",{attrs:{icon:"dengji",text:"会员等级",size:"14"}}),e._v(" "),a("span",[e._v(e._s(e.member.memberLvlId?e.member.memberLvl.lvlName:"普通会员"))]),e._v(" "),e.isLoading?e._e():a("select",{directives:[{name:"model",rawName:"v-model",value:e.memberLvlId,expression:"memberLvlId"}],ref:"lvName",on:{change:[function(s){var a=Array.prototype.filter.call(s.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.memberLvlId=s.target.multiple?a:a[0]},e.updateEditMemberLvl]}},[a("option",{attrs:{value:""}},[e._v("普通会员")]),e._v(" "),e._l(e.memberLvlList,function(s){return a("option",{key:s.id,domProps:{value:s.id}},[e._v(e._s(s.lvlName))])})],2)],1)])]),e._v(" "),a("div",{staticClass:"member-car"},[a("ul",[a("li",{staticClass:"member-car-btn"},[a("zs-icon",{attrs:{icon:"serving",text:"车辆",size:"25"}}),e._v(" "),e.updateFlag?a("a",{on:{click:e.handleGoCar}},[e._v("添加更换")]):e._e()],1),e._v(" "),a("li",{staticClass:"member-car-num"},e._l(e.member.user.cars,function(s,t){return a("span",{key:"car.id"},[e._v(e._s(s.carNumber))])}))])]),e._v(" "),a("div",{staticClass:"member-pack"},[a("ul",{staticClass:"pack-info"},[a("li",[a("zs-icon",{attrs:{icon:"pack",text:"套餐信息",size:"25"}})],1)]),e._v(" "),e.packages.length>0?a("ul",{staticClass:"pack-detail"},e._l(e.packages,function(s){return a("li",{key:s.id,staticClass:"item",class:e.handleListState(s)},[a("div",{staticClass:"item-head"},[a("p",{staticClass:"head-info"},[s.businessPackage?a("span",{staticClass:"item-name"},[e._v(e._s(s.businessPackage.packageName))]):a("span",{staticClass:"item-name"}),e._v(" "),a("zs-icon",{staticClass:"item-time",attrs:{icon:"time",size:"13","icon-dis":"5",text:e.handleValidTime(s)}})],1),e._v(" "),a("p",{staticClass:"head-info"},[s.payType&&2==s.payType?a("zs-icon",{attrs:{icon:"wechat",size:"13","icon-dis":"5",text:"微信付款"}}):a("zs-icon",{attrs:{icon:"cash",size:"13","icon-dis":"5",text:"现金付款"}}),e._v(" "),a("span",{staticClass:"item-pay"},[e._v("￥"+e._s(s.totalAmount||s.businessPackage.salePrice))]),e._v(" "),a("zs-icon",{staticClass:"item-time",attrs:{icon:"time",size:"13","icon-dis":"5",text:e.handlePayTime(s)}})],1)]),e._v(" "),a("div",{staticClass:"service-info"},e._l(s.memberItemUseRecords,function(t,i){return a("p",{directives:[{name:"show",rawName:"v-show",value:i<3||s.showAll,expression:"index < 3 || p.showAll"}],key:t.id},[e._v("\n                            "+e._s(t.serviceItem.itemName)+"\n                            "),a("span",[a("i",[e._v("总 "+e._s(t.useTimes))]),e._v(" -\n                        "),a("i",[e._v("用 "+e._s(t.useTimes-t.remainTimes))]),e._v(" -\n                        "),a("i",[e._v("余 "+e._s(t.remainTimes))])])])})),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:!s.showAll&&s.memberItemUseRecords.length>3,expression:"!p.showAll && p.memberItemUseRecords.length>3"}],staticClass:"show-more-item",on:{click:function(e){s.showAll=!0}}},[e._v("\n                        查看更多")])])})):a("ul",[a("li",{staticClass:"list-empty"},[e._v("暂无套餐")])])])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.currTab,expression:"currTab==1"}],staticClass:"member-info-2"},[a("div",{staticClass:"pay-search arrow-right"},[a("zs-icon",{attrs:{icon:"order-pay",text:"工单消费记录",size:25}}),e._v(" "),a("span",{staticClass:"gray"},[e._v("(共"+e._s(e.total)+"条)")]),e._v(" "),a("span",{staticClass:"car-search-text r"},[e._v(e._s(e.searchKey?e.searchKey:"所有车辆"))]),e._v(" "),a("select",{directives:[{name:"model",rawName:"v-model",value:e.searchKey,expression:"searchKey"}],staticClass:"car-search ",attrs:{name:"",id:""},on:{change:[function(s){var a=Array.prototype.filter.call(s.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.searchKey=s.target.multiple?a:a[0]},function(s){e.selectPayList(function(){},!1)}]}},[a("option",{attrs:{value:""}},[e._v("不限")]),e._v(" "),e._l(e.member.user.cars,function(s,t){return a("option",{key:t,domProps:{value:s.carNumber}},[e._v("\n                    "+e._s(s.carNumber)+"\n                ")])})],2)],1),e._v(" "),a("ul",{staticClass:"item-list",class:[{"is-operator":e.isOperator}]},[e.workOrders.length>0?[e._l(e.workOrders,function(s){return a("li",{key:s.id,staticClass:"list",on:{click:function(a){e.handleCheck(s.id)}}},[a("div",{staticClass:"list-info"},[a("zs-icon",{staticClass:"car-number",attrs:{icon:"car",size:"20","icon-dis":"10",text:s.carNumber}})],1),e._v(" "),a("ul",{staticClass:"items"},[e._l(s.workOrderDetails,function(s,t){return t<3?a("li",[e._v("\n                            "+e._s(s.serviceItemName+(e.isOperator?"":" * "+s.itemsTimes))+"\n                            "),a("span",[e._v(e._s(e.isOperator?"x "+s.itemsTimes:s.workerName||""))])]):e._e()}),e._v(" "),s.workOrderDetails.length>3?a("li",[e._v("···")]):e._e()],2),e._v(" "),a("div",{staticClass:"control"},[a("zs-icon",{attrs:{icon:["","cash-pay","wechat-pay"][s.payType],text:["","现金收款","微信收款"][s.payType],"icon-dis":"6",size:"17"}}),e._v(" "),a("span",{staticClass:"total-price"},[e._v("￥"+e._s(s.totalPrice))])],1),e._v(" "),e.isOperator&&4==s.state?a("div",{staticClass:"control"},[a("span",{staticClass:"operator-detail"},[e._v("项目金额"),a("i",[e._v(e._s(e.calcItemsPrice(s.workOrderDetails)))])])]):e._e()])}),e._v(" "),a("li",{staticClass:"show-more",class:[{"no-more":!e.hasNextPage}],on:{click:e.handleShowMore}},[e._v(e._s(e.hasNextPage?"查看更多":"已显示全部")+"\n                ")])]:a("li",{staticClass:"list-empty"},[e._v("暂无消费记录")])],2)]),e._v(" "),a("zs-dialog",{staticClass:"edit-dialog",attrs:{"show-close":""},model:{value:e.realNameVisible,callback:function(s){e.realNameVisible=s},expression:"realNameVisible"}},[a("p",[e._v("姓名")]),e._v(" "),a("p",[a("zs-input",{attrs:{placeholder:"请输入姓名"},model:{value:e.realName,callback:function(s){e.realName=s},expression:"realName"}})],1),e._v(" "),a("ul",{slot:"footer"},[a("li",[a("div",{on:{click:function(s){e.realNameVisible=!1}}},[e._v("取消")])]),e._v(" "),a("li",[a("div",{on:{click:e.handleEditRealName}},[e._v("确定")])])])]),e._v(" "),a("zs-dialog",{staticClass:"edit-dialog",attrs:{"show-close":""},model:{value:e.mobileVisible,callback:function(s){e.mobileVisible=s},expression:"mobileVisible"}},[a("p",[e._v("手机号")]),e._v(" "),a("p",[a("zs-input",{attrs:{placeholder:"请输入手机号"},model:{value:e.mobile,callback:function(s){e.mobile=s},expression:"mobile"}})],1),e._v(" "),a("ul",{slot:"footer"},[a("li",[a("div",{on:{click:function(s){e.mobileVisible=!1}}},[e._v("取消")])]),e._v(" "),a("li",[a("div",{on:{click:e.handleEditMobile}},[e._v("确定")])])])]),e._v(" "),a("zs-dialog",{staticClass:"edit-dialog",attrs:{"show-close":""},model:{value:e.remarkVisible,callback:function(s){e.remarkVisible=s},expression:"remarkVisible"}},[a("p",[e._v("客户备注")]),e._v(" "),a("p",[a("zs-input",{attrs:{maxlength:5,placeholder:"请输入客户备注"},model:{value:e.remarks,callback:function(s){e.remarks=s},expression:"remarks"}})],1),e._v(" "),a("ul",{slot:"footer"},[a("li",[a("div",{on:{click:function(s){e.remarkVisible=!1}}},[e._v("取消")])]),e._v(" "),a("li",[a("div",{on:{click:e.updateEditRemark}},[e._v("确定")])])])])],1)},staticRenderFns:[]}},351:function(e,s){},479:function(e,s,a){e.exports=a(76)},76:function(e,s,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t=a(1),i=a(249),r=a.n(i),l=a(5),o=(a.n(l),a(3),a(4));t.a.use(o.a),new t.a({el:"#app",render:function(e){return e(r.a)}})}},[479]);