webpackJsonp([53],{140:function(s,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=a(7),i=a(2),n=a(16),o=a(8),c=a(26),r=(a.n(c),a(6)),l=a.n(r);e.default={components:{maHead:l.a},data:function(){return{isLoading:!0,currPoint:"",currTab:1,tabFix:!1,sTop:0,winH:0,openId:"",lng:"",lat:"",businessId:"",businessName:"",businessAddress:"",packageCount:0,imageShowPath:"",businessTel:"",distance:0,targetPoint:"",businessDescript:"",currType:"",itemTypes:[],businessItems:[],memberBalance:0,packages:[],packagePage:{startPage:1,pageSize:10,hasNextPage:!1}}},computed:{_distance:function(){return this.distance>1e3?(this.distance/1e3).toFixed(2)+"km":this.distance+"m"},businessPic:function(){var s={};return s.backgroundImage="url("+this.imageShowPath+")",s}},methods:{handleScroll:function(){var s=this;a.i(c.debounce)(30,function(){s.sTop=document.body.scrollTop,s.tabFix=s.sTop>=280})()},handleTabChange:function(s){this.currTab=s,document.body.scrollTop=this.sTop>280?280:this.sTop},selectBusiness:function(s,e){var a=this;this.$ajax(this.$joggle.customer.business.selectBusiness,{lng:this.lng,lat:this.lat,wxOpenId:this.openId,businessId:this.businessId},e,function(e){"ZS011000"===e.code?(a.businessName=e.data.businessName,a.businessAddress=""+e.data.businessAreaCodeDes+e.data.businessAddress,a.packageCount=e.data.packageCount,a.imageShowPath=e.data.imageShowPath,a.businessTel=e.data.businessTel,a.distance=e.data.distance,a.targetPoint=e.data.businessCoordinate,a.businessDescript=e.data.businessDetail,a.memberBalance=e.data.memberBalance):a.$message({type:"error",message:e.msg}),s&&s()})},selectItemType:function(s,e){var a=this;this.$ajax(this.$joggle.mzscp.selectConstantTypes,{codeTypes:"ServiceItemType"},e,function(e){if("ZS011000"===e.code){var t=e.data.ServiceItemType;t.unshift(["","全部"]),a.itemTypes=t}else a.$message({type:"error",message:e.msg});s&&s()})},handleSelectItemType:function(s){this.currType=s;var e=this.$loading();this.selectBusinessItem(function(){e.close()},e)},selectBusinessItem:function(s,e){var a=this;this.$ajax(this.$joggle.customer.business.selectBusinessItem,{itemType:this.currType,businessId:this.businessId},e,function(e){"ZS011000"===e.code?a.businessItems=e.data:a.$message({type:"error",message:e.msg}),s&&s()})},businessPackage:function(s,e,a){var t=this;a?this.packagePage.startPage++:this.packagePage.startPage=1,this.$ajax(this.$joggle.customer.business.selectBusinessPackage,{startPage:this.packagePage.startPage,pageSize:this.packagePage.pageSize,businessId:this.businessId},e,function(e){if("ZS011000"===e.code){var i=[];e.data.list.forEach(function(s){s.showAll=!1,i.push(s)}),t.packagePage.hasNextPage=e.data.hasNextPage,t.packages=a?t.packages.concat(i):i}else t.$message({type:"error",message:e.msg});s&&s()})},handleShowMore:function(){if(this.packagePage.hasNextPage){var s=this.$loading();this.businessPackage(function(){s.close()},s,!0)}},handleGoBack:function(){window.history.go(-1)},handleDial:function(s){a.i(i.c)(s)||(window.location.href="tel:"+s)},handleToMap:function(){var s={startPoint:encodeURIComponent(this.currPoint),endPoint:encodeURIComponent(this.targetPoint),storeName:encodeURIComponent(this.businessName),storeAddress:encodeURIComponent(this.businessAddress),storeImgPath:this.imageShowPath,storeTel:this.businessTel,storeDescription:encodeURIComponent(this.businessDescript)};a.i(i.d)("/wap/customer/open/business/map.html",s)}},mounted:function(){if(this.openId=a.i(i.a)("i")?o.a.decode(a.i(i.a)("i")):"",this.businessId=a.i(i.a)("id")||"",this.winH=document.body.clientHeight,a.i(i.c)(this.openId))return void a.i(t.a)("/wap/open/customer/detail_user.html","emkt");if(a.i(i.c)(this.businessId))return void this.$message({type:"error",message:"数据不存在"});var s=this.$loading(),e=this;this.map=new BMap.Map("#map"),(new BMap.Geolocation).getCurrentPosition(function(a){if(this.getStatus()==BMAP_STATUS_SUCCESS){e.currPoint=a.point.lng+","+a.point.lat,e.lng=a.point.lng,e.lat=a.point.lat;var t=new Promise(function(a){e.selectBusiness(function(){a()},s)}),i=new Promise(function(a){e.selectItemType(function(){a()},s)}),n=new Promise(function(a){e.selectBusinessItem(function(){a()},s)}),o=new Promise(function(a){e.businessPackage(function(){a()},s)});Promise.all([t,i,n,o]).then(function(){s.close(),e.isLoading=!1})}else e.$message({type:"error",message:"无法获取当前位置"})},{enableHighAccuracy:!0}),a.i(n.c)(window,"scroll",this.handleScroll)},beforeDestroy:function(){a.i(n.d)(window,"scroll",this.handleScroll)}}},215:function(s,e,a){a(373);var t=a(0)(a(140),a(299),null,null);s.exports=t.exports},299:function(s,e){s.exports={render:function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:!s.isLoading,expression:"!isLoading"}],staticClass:"business-detail-page",class:[{"has-head":s.sTop>0,"is-tab-fixed":s.tabFix}],on:{scroll:s.handleScroll}},[a("transition",{attrs:{name:"head-fade"}},[a("ma-head",{directives:[{name:"show",rawName:"v-show",value:s.sTop>0,expression:"sTop > 0"}],attrs:{home:!1}},[s._v(s._s(s.businessName))])],1),s._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!s.tabFix,expression:"!tabFix"}],staticClass:"detail-head",style:s.businessPic},[0===s.sTop?a("p",{staticClass:"arrow",on:{click:s.handleGoBack}},[a("i")]):s._e(),s._v(" "),a("div",{staticClass:"business-info"},[a("div",{staticClass:"info-p1"},[a("p",[s._v(s._s(s.businessName)+"\n                ")])]),s._v(" "),a("p",{staticClass:"info-p4"},[s.packageCount>0?a("span",[s._v("有卡")]):s._e(),a("span",[s._v("余额:"+s._s(s.memberBalance||0))])]),s._v(" "),a("p",{staticClass:"info-p2"},[a("span",[s._v("地址：")]),s._v(s._s(s.businessAddress))]),s._v(" "),a("ul",{staticClass:"info-p3"},[a("li",{on:{click:function(e){s.handleDial(s.businessTel)}}},[s._v(s._s(s.businessTel||"----"))]),s._v(" "),a("li",{on:{click:s.handleToMap}},[s._v(s._s(s._distance||"--")+"(查看地图)")])])])]),s._v(" "),a("p",{staticClass:"detail-tab",class:[{"tab-fix":s.tabFix}]},[a("span",{staticClass:"tab1",class:[{curr:1==s.currTab}],on:{click:function(e){s.handleTabChange(1)}}},[s._v("服务项目")]),s._v(" "),a("span",{staticClass:"tab2",class:[{curr:2==s.currTab}],on:{click:function(e){s.handleTabChange(2)}}},[s._v("服务套餐")])]),s._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:1==s.currTab,expression:"currTab == 1"}],staticClass:"detail-item-select",style:{minHeight:"300px"}},[a("ul",{staticClass:"menu",class:[{"menu-fix":s.tabFix}]},s._l(s.itemTypes,function(e){return a("li",{key:e[0],class:[{curr:s.currType===e[0]}],on:{click:function(a){s.handleSelectItemType(e[0])}}},[s._v(s._s(e[1])+"\n            ")])})),s._v(" "),s.businessItems.length>0?a("ul",{staticClass:"list"},s._l(s.businessItems,function(e){return a("li",{key:e.id},[s._v(s._s(e.itemName)+"\n                "),a("span",[s._v("￥"+s._s(e.salePrice?e.salePrice.toFixed(2):0))])])})):a("div",{staticClass:"list business-item-empty"},[s._v("\n            暂无相关项目\n        ")])]),s._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:2==s.currTab,expression:"currTab == 2"}],staticClass:"detail-package"},[s.packages.length>0?a("ul",{staticClass:"package-list"},[s._l(s.packages,function(e){return a("li",{key:e.id,staticClass:"package"},[a("div",{staticClass:"package-info"},[a("p",{staticClass:"p1"},[s._v("\n                        "+s._s(e.packageName)+"\n                    ")]),s._v(" "),a("p",{staticClass:"p2"},[s._v("\n                        ￥"+s._s(e.salePrice)+"\n                        "),a("span",{staticClass:"original-price"},[s._v("价值："+s._s(e.originalPrice))]),s._v(" "),a("zs-icon",{staticClass:"validate-time",attrs:{size:"12",icon:"time4","icon-dis":"4",text:"有效期："+(0==e.validTerm?"永久":e.validTerm+"年")}})],1)]),s._v(" "),a("div",{staticClass:"item-info"},s._l(e.packageAndItems,function(t,i){return i<3||e.showAll?a("p",{key:t.id},[s._v(s._s(t.serviceItem.itemName)),a("span",[s._v(s._s(t.useTimes)+"次")])]):s._e()})),s._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:!e.showAll&&e.packageAndItems.length>3,expression:"!package.showAll && package.packageAndItems.length>3"}],staticClass:"show-more-item",on:{click:function(s){e.showAll=!0}}},[a("span",[s._v("查看更多")])])])}),s._v(" "),s.packages.length>0?a("li",{staticClass:"show-more",class:[{"no-more":!s.packagePage.hasNextPage}],on:{click:s.handleShowMore}},[s._v(s._s(s.packagePage.hasNextPage?"查看更多":"已显示全部")+"\n            ")]):s._e()],2):a("p",{staticClass:"package-list package-empty"},[s._v("暂无服务套餐")])]),s._v(" "),a("div",{attrs:{id:"map"}})],1)},staticRenderFns:[]}},373:function(s,e){},43:function(s,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=a(1),i=a(215),n=a.n(i),o=a(5),c=(a.n(o),a(4));a(3);t.a.use(c.a),new t.a({el:"#app",render:function(s){return s(n.a)}})},446:function(s,e,a){s.exports=a(43)}},[446]);