webpackJsonp([20],{183:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=t(2),i=t(12),o=t(6),c=t.n(o),r=t(9),n=t.n(r);a.default={components:{maHead:c.a,carNumber:n.a},data:function(){return{isLoading:!0,isEdit:!1,nextPageVisible:!1,isOperator:"",operatorId:"",operatorName:"",operatorItemType:"",currCarArea:"",currCarLetter:"",currCarNum:"",memberRecordId:"",memberLvl:"",packageRemain:{},remarks:"",useBalance:!0,memberBalanceDeduct:0,itemTypes:[],itemType:"",itemDatas:[],itemSelectDatas:[],totalSelectItemId:[],finalData:{id:"",totalPrice:"",carNumber:"",workOrderDetails:[],userId:"",user:{realName:""},state:1,mobile:"",businessDeduct:"",materialCost:"",payType:"",comment:""},couponSelectVisible:!1,couponsData:[],couponsItemData:[],couponKey:1,currItemIndex:"",currItemType:"",searchPage:!1,memberData:[],hasNextPage:!1,memberPara:{keyWord:"",startPage:1,pageSize:10}}},computed:{itemTotalPrice:function(){var e=0;return this.itemSelectDatas.forEach(function(a){e+=a.itemsTimes*a.salePrice}),parseFloat(t.i(s.c)(e)?0:e).toFixed(2)},itemCalcTotalPrice:function(){var e=0;return this.itemSelectDatas.forEach(function(a){e+=parseFloat(a.totalPrice)}),parseFloat(e).toFixed(2)},priceBeforeBusinessDeduct:function(){return parseFloat(this.itemCalcTotalPrice)+parseFloat(this.finalData.materialCost||0)},totalPriceBeforeBalance:function(){var e=this.priceBeforeBusinessDeduct-(this.finalData.businessDeduct||0);return parseFloat(e>0?e:0).toFixed(2)},totalPrice:function(){var e=this.totalPriceBeforeBalance-(this.useBalance?this.memberBalanceDeduct:0);return parseFloat(e>0?e:0).toFixed(2)}},methods:{updateWorkOrder:function(){var e=this;this.itemSelectDatas.forEach(function(e){!e._useCard&&(e.usePackageTimes=0)}),this.finalData.workOrderDetails=this.itemSelectDatas,this.finalData.totalPrice=parseFloat(this.totalPrice),this.finalData.businessDeduct=Math.min(this.priceBeforeBusinessDeduct,parseFloat(this.finalData.businessDeduct||0)).toFixed(2),this.finalData.materialCost=parseFloat(this.finalData.materialCost||0).toFixed(2),this.finalData.balanceDeduct=this.useBalance?Math.min(parseFloat(this.memberBalanceDeduct),parseFloat(this.totalPriceBeforeBalance)).toFixed(2):0,t.i(s.h)(this.finalData.carNumber)?t.i(s.c)(this.finalData.mobile)||t.i(s.i)(this.finalData.mobile)?this.$ajax(this.$joggle.merchant.workorder.updateWorkOrder,this.finalData,!0,function(a,i){i.close(),"ZS011000"===a.code?(e.$message({type:"success",message:a.msg}),setTimeout(function(){t.i(s.d)("/wap/merchant/home/workorder/list.html"+(e.isOperator?"#eyJ0YWIiOjF9":"#eyJ0YWIiOjJ9"))},1200)):e.$message({type:"error",message:a.msg})}):this.$message({type:"error",message:"请输入正确的手机号码!"}):this.$message({type:"error",message:"车牌号码有误!"})},selectDefaultCarArea:function(e,a){var i=this;this.$ajax(this.$joggle.business.selectBusinessInfo,{},a,function(a){if("ZS011000"===a.code){if(!t.i(s.c)(a.data)){var o=a.data.defaultCar;i.currCarArea=o?o[0]:"闽",i.currCarLetter=o?o[1]:"D"}}else i.$message({type:"error",message:a.msg,duration:1200});e&&e()},function(){e&&e()})},selectWorkOrder:function(e,a,i){var o=this;this.$ajax(this.$joggle.merchant.workorder[t.i(s.c)(i)?"selectWorkOrderByCarNumber":"selectWorkOrderById"],t.i(s.c)(i)?{carNumber:this.finalData.carNumber}:{orderId:i},a,function(a,c){if("ZS011000"===a.code){var r=a.data.workOrder,n=a.data.user,l=t.i(s.c)(n)?"":n.mobile;if(o.totalSelectItemId=o.isOperator?a.data.serviceIdList||[]:[],o.packageRemain=o.handlePackageMerge(t.i(s.c)(n)?[]:n.packageList),!t.i(s.c)(i)){if(t.i(s.c)(r))return void o.$message({type:"error",message:"工单不存在！"});o.finalData.carNumber=t.i(s.c)(r)?"":r.carNumber}o.finalData.id=t.i(s.c)(r)?"":r.id,o.finalData.mobile=t.i(s.c)(r)?l:r.mobile||"",o.finalData.businessDeduct=t.i(s.c)(r)?"":r.businessDeduct||"",o.finalData.materialCost=t.i(s.c)(r)?"":r.materialCost||"",o.finalData.comment=t.i(s.c)(r)?"":r.comment||"",o.finalData.user.realName=t.i(s.c)(n)?"":n.realName,o.finalData.userId=t.i(s.c)(n)?"":n.userId||"",o.memberRecordId=t.i(s.c)(n)?"":n.recordId||"",o.remarks=t.i(s.c)(n)?"":n.remarks||"",o.memberLvl=t.i(s.c)(o.memberRecordId)?"非会员":n.lvlName||"普通会员",o.memberBalanceDeduct=t.i(s.c)(n)?0:n.memberBalance||0;var u=new Promise(function(e){o.selectCouponsByCarNumber(function(){var a=t.i(s.c)(r)?[]:r.workOrderDetails||[];o.itemDatas.forEach(function(e){for(var t=!0,s=0;s<a.length;s++)if(a[s].serviceItemId==e.id){o.$set(e,"itemsTimes",a[s].itemsTimes),t=!1;break}t&&o.$set(e,"itemsTimes",0)}),a.forEach(function(e){e._hasCard=e._useCard=!1,(t.i(s.c)(e.itemType)||t.i(s.c)(e.serviceItemId))&&(e.itemType=-1),e._autoCoupon=!1;for(var a in o.packageRemain)if(o.packageRemain[a]>0&&a==e.serviceItemId){e._hasCard=!0,e._useCard=parseInt(e.usePackageTimes||0)>0,e.usePackageTimes=Math.min(e.itemsTimes,o.packageRemain[a]);break}o.$set(e,"couponKey",o.couponKey);var i=!1;t.i(s.c)(e.couponUuid)||(o.couponsData.forEach(function(a){e.couponUuid===a.takeUuid&&(o.$set(a,"couponKey",o.couponKey),i=!0)}),i||(o.$set(e,"couponUuid",""),o.$set(e,"couponName",""),o.$set(e,"couponDeduct",""))),o.couponKey++}),o.itemSelectDatas=a,e()},c)}),m=new Promise(function(e){o.selectServiceItem(function(){e()},c)});Promise.all([u,m]).then(function(){e&&e()})}else c.close(),o.$message({type:"error",message:a.msg,duraton:1200})},function(){o.finalData.id="",o.finalData.totalPrice=0,o.finalData.workOrderDetails=[],o.finalData.userId="",o.finalData.user.realName="",o.finalData.mobile="",o.finalData.businessDeduct="",o.finalData.materialCost="",o.finalData.comment="",o.itemSelectDatas=[],o.itemDatas.forEach(function(e){o.$set(e,"itemsTimes",0)}),o.memberLvl="",o.packageRemain={}})},selectItemType:function(e,a){var t=this;this.$ajax(this.$joggle.mzscp.selectConstantTypes,{codeTypes:"ServiceItemType"},a,function(a){if("ZS011000"===a.code){var s=a.data.ServiceItemType;s.unshift(["","全部"]),t.itemTypes=s}else t.$message({type:"error",message:a.msg,duration:1200});e&&e()})},selectServiceItem:function(e,a){var t=this;this.$ajax(this.$joggle.merchant.workorder.selectServiceItemByPage,{itemType:this.itemType,startPage:1,pageSize:999,userId:this.finalData.userId},a,function(a){if("ZS011000"===a.code){var s=a.data.list;s.forEach(function(e){for(var a=!0,s=0;s<t.itemSelectDatas.length;s++)if(t.itemSelectDatas[s].serviceItemId==e.id){t.$set(e,"itemsTimes",t.itemSelectDatas[s].itemsTimes),a=!1;break}a&&t.$set(e,"itemsTimes",0)}),t.itemDatas=s}else t.$message({type:"error",message:a.msg});e&&e()})},selectCouponsByCarNumber:function(e,a){var t=this;if(this.isOperator)return void(e&&e());this.$ajax(this.$joggle.merchant.workorder.selectCouponsByCarNumber,{carNumber:this.finalData.carNumber},a,function(a){"ZS011000"===a.code?t.couponsData=a.data:t.$message({type:"error",message:a.msg,duration:1200}),e&&e()})},selectMemberData:function(e){var a=this;this.memberPara.carSelect=""+this.currCarArea+this.currCarLetter,e?this.memberPara.startPage++:this.memberPara.startPage=1,this.$ajax(this.$joggle.merchant.workorder.selectMemberByCarNumber,this.memberPara,!0,function(t,s){s.close(),"ZS011000"===t.code?(a.hasNextPage=t.data.hasNextPage,a.memberData=e?a.memberData.concat(t.data.list):t.data.list):a.$message({type:"error",message:t.msg})})},handleToMemberDetail:function(){var e=this;t.i(s.c)(this.memberRecordId)||this.isOperator||(window.localStorage.wo=JSON.stringify(this.$data),setTimeout(function(){t.i(s.d)("/wap/merchant/home/member/detail.html",{id:e.memberRecordId})},100))},handleGoHome:function(){t.i(s.d)("/wap/merchant/home/manage/index.html")},handleGetCarNumber:function(e){if(this.finalData.carNumber=e,!(e.length<7))if(t.i(s.h)(e))if(t.i(s.c)(window.localStorage.wo)){var a=this.$loading();this.selectWorkOrder(function(){a.close()},a)}else window.localStorage.wo="";else this.$message({type:"error",message:"车牌号码有误!"})},handlePackageMerge:function(e){var a={1:0};if(e.length>0)for(var t=0;t<e.length;t++)if(e[t].memberItemUseRecords.length>0)for(var s=e[t].memberItemUseRecords,i=0;i<s.length;i++){var o=!0;for(var c in a)if(parseInt(c)===parseInt(s[i].serviceItem.id)){a[c]=parseInt(a[c])+parseInt(s[i].remainTimes),o=!1;break}o&&(a[s[i].serviceItem.id]=s[i].remainTimes)}return a},handleSelectItemType:function(e){this.itemType=e;var a=this.$loading();this.selectServiceItem(function(){a.close()},a)},handleItemTimesChange:function(e,a){for(var i=this,o=!0,c=Math.min(a,this.packageRemain[e.id]||0),r=0;r<this.itemSelectDatas.length;r++){var n=i.itemSelectDatas[r];if(n.serviceItemId===e.id){if(0===a){for(var l=0;l<this.couponsData.length;l++)if(i.couponsData[l].couponKey===i.itemSelectDatas[r].couponKey){i.$set(i.couponsData[l],"couponKey","");break}i.$delete(i.itemSelectDatas,r)}else{n.itemsTimes=a,n.usePackageTimes=c;var u=i.handleChooseMaxCoupon(n,n.couponKey);if(!t.i(s.c)(u.takeUuid)&&n._autoCoupon)i.$set(n,"couponUuid",u.takeUuid),i.$set(n,"couponName",u.coupon.cpName),i.$set(n,"couponDeduct",u.coupon.cpMoney),i.$set(n,"_useCard",!1);else{i.$set(n,"couponUuid",""),i.$set(n,"couponName",""),i.$set(n,"couponDeduct",0);for(var m=0;m<this.couponsData.length;m++)if(i.couponsData[m].couponKey===n.couponKey){i.$set(i.couponsData[m],"couponKey","");break}}}o=!1;break}}if(o){var p=this.packageRemain[e.id]&&this.packageRemain[e.id]>0,d=this.couponKey;e._autoCoupon=!0;var h=this.handleChooseMaxCoupon(e,d),f={id:"",serviceItemId:e.id,serviceItemName:e.itemName,itemsTimes:a,usePackageTimes:c,salePrice:e.salePrice,workerId:this.isOperator?this.operatorId:"",salerId:this.isOperator?this.operatorId:"",workerName:this.isOperator?this.operatorName:"",salerName:this.isOperator?this.operatorName:"",itemType:e.itemType,discountType:e.discountType||"",discountPrice:0,discountNumber:e.discountNumber||(1==e.discountType?10:0),couponKey:d,couponUuid:h.takeUuid||"",couponName:h.coupon?h.coupon.cpName||"":"",couponDeduct:h.coupon?h.coupon.cpMoney||0:0,totalPrice:0,_autoCoupon:!this.isOperator,_hasCard:p,_useCard:p&&t.i(s.c)(h.takeUuid)};this.itemSelectDatas.push(f),this.couponKey++}},handleItemTimesNotice:function(e){this.totalSelectItemId.indexOf(e.id)>-1&&this.$message({type:"error",message:"已有员工创建该项目"})},handleNext:function(){0!==this.itemSelectDatas.length&&(this.isOperator?this.updateWorkOrder():t.i(s.h)(this.finalData.carNumber)?this.nextPageVisible=!0:this.$message({type:"error",message:"车牌号码有误！"}))},handleToggleUseCard:function(e){var a=this,t=this.itemSelectDatas[e];if(this.$set(t,"_autoCoupon",!1),t._useCard){this.$set(t,"couponUuid",""),this.$set(t,"couponName",""),this.$set(t,"couponDeduct",0);for(var s=0;s<this.couponsData.length;s++)if(a.couponsData[s].couponKey===t.couponKey){a.$set(a.couponsData[s],"couponKey","");break}}},handleCalcDiscountPrice:function(e,a){var t=0,s=(e.itemsTimes-(e._useCard?e.usePackageTimes:0))*e.salePrice-(e.couponDeduct||0);if(1==e.discountType)t=parseFloat((1-e.discountNumber/10)*s).toFixed(2);else if(2==e.discountType){var i=(e.itemsTimes-(e._useCard?e.usePackageTimes:0))*(e.salePrice-e.discountNumber);t=parseFloat(i-s>0?s:i).toFixed(2)}return this.$set(this.itemSelectDatas[a],"discountPrice",parseFloat(t)),t},handleCalcItemTotalPrice:function(e,a){var t=parseFloat((e.itemsTimes-(e._useCard?e.usePackageTimes:0))*e.salePrice-(e.couponDeduct||0)-e.discountPrice).toFixed(2);return this.$set(this.itemSelectDatas[a],"totalPrice",parseFloat(t)),t},handleChooseMaxCoupon:function(e,a){var i=e.itemType,o=e.salePrice*(e.itemsTimes||1),c={coupon:{cpMoney:0}},r=-1;return this.couponsData.forEach(function(a,n){e._autoCoupon&&(t.i(s.c)(a.couponKey)||a.couponKey===e.couponKey)&&(!a.coupon.itemType||i==a.coupon.itemType)&&a.coupon.cpMoney-o<=0&&a.coupon.cpMoney-c.coupon.cpMoney>=0&&(c=a,r=n)}),r>-1?(this.$set(this.couponsData[r],"couponKey",a),this.couponsData[r]):{}},handlePopCoupon:function(e,a){var t=this;if(this.itemSelectDatas[a]._useCard)return void this.$message({type:"warning",message:"已选择使用套餐，不能使用优惠券！"});this.currItemIndex=a,this.currItemType=e||"-1";var s=[];this.couponsData.forEach(function(e,a){t.handleCouponListShow(e)&&(e._index=a,s.push(e))}),this.couponsItemData=s,this.couponsItemData.length>0&&(this.couponSelectVisible=!0)},handleCouponListShow:function(e,a){a=t.i(s.c)(a)?this.currItemIndex:a;var i=this.itemSelectDatas[a],o=i.itemType;return!t.i(s.c)(i)&&((!e.couponKey||e.couponKey==i.couponKey)&&(!e.coupon.itemType||e.coupon.itemType==o)&&e.coupon.cpMoney-i.itemsTimes*i.salePrice<=0)},handleSelectCoupon:function(e){var a=this,t=this.itemSelectDatas[this.currItemIndex];this.$set(t,"_autoCoupon",!1);for(var s=0;s<this.couponsData.length;s++)if(a.couponsData[s].takeUuid===e){a.couponsData[s].couponKey===t.couponKey?(a.$set(a.couponsData[s],"couponKey",""),a.$set(t,"couponUuid",""),a.$set(t,"couponName",""),a.$set(t,"couponDeduct",0)):(a.couponsItemData.forEach(function(e){a.$set(e,"couponKey",""),a.$set(a.couponsData[e._index],"couponKey","")}),a.$set(a.couponsData[s],"couponKey",t.couponKey),a.$set(t,"couponUuid",a.couponsData[s].takeUuid),a.$set(t,"couponName",a.couponsData[s].coupon.cpName),a.$set(t,"couponDeduct",a.couponsData[s].coupon.cpMoney));break}this.couponSelectVisible=!1},handleCouponShow:function(e,a){var t=this,s=[];return this.couponsData.forEach(function(e){t.handleCouponListShow(e,a)&&s.push(e)}),0===s.length?"暂无可用卡券":e.couponName?"-￥"+e.couponDeduct:"请选择卡券"},handSetBackgroundClass:function(e){return e?"list-p-wx-img":""},handleShowMore:function(){this.hasNextPage&&this.selectMemberData(!0)},handSelectMemberData:function(e){var a=e.carNumber;this.currCarArea=a[0],this.currCarLetter=a[1],this.currCarNum=a.slice(2),this.finalData.carNumber=a,this.searchPage=!1}},mounted:function(){var e=this;if(window.localStorage.wo){for(var a in this.$data)e[a]=JSON.parse(window.localStorage.wo)[a];return this.currCarArea=this.finalData.carNumber[0],this.currCarLetter=this.finalData.carNumber[1],this.currCarNum=this.finalData.carNumber.slice(2),void(this.isLoading=!1)}t.i(i.a)(function(a){e.isOperator=!!a.mercharType&&a.mercharType.indexOf("operator")>-1,e.operatorId=a.id||"",e.operatorItemType=a.itemTypes||"1,2,3,4,5",e.operatorName=a.userName||""}),this.finalData.id=t.i(s.a)("id")||"",this.isEdit=!t.i(s.c)(this.finalData.id);var o=this.$loading(),c=new Promise(function(a){e.selectItemType(function(){a()},o)}),r=new Promise(function(a){e.selectServiceItem(function(){t.i(s.c)(e.finalData.id)?a():e.selectWorkOrder(function(){a()},o,e.finalData.id)},o)}),n=new Promise(function(a){e.isEdit?a():e.selectDefaultCarArea(function(){a()},o)});Promise.all([c,r,n]).then(function(){o.close(),e.isLoading=!1})}}},258:function(e,a,t){t(354);var s=t(0)(t(183),t(277),null,null);e.exports=s.exports},277:function(e,a){e.exports={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"workorder-page"},[t("ma-head",{attrs:{home:!e.isOperator,rightIcon:"search1",rightIconSize:18},on:{"home-click":e.handleGoHome,"right-icon-click":function(a){e.searchPage=!0}}},[e._v(e._s(e.isEdit?"修改工单":"开单")+"\n    ")]),e._v(" "),e.isEdit?t("div",{staticClass:"car-number-show"},[t("zs-icon",{attrs:{icon:"car",size:"24",text:"服务车辆"}}),e._v("\n        "+e._s(this.finalData.carNumber)+"\n    ")],1):t("car-number",{attrs:{"car-province":e.currCarArea,"car-letter":e.currCarLetter,"car-num":e.currCarNum,"photo-icon":""},on:{"get-car-number":e.handleGetCarNumber}}),e._v(" "),t("div",{staticClass:"item-select"},[t("ul",{staticClass:"menu"},e._l(e.itemTypes,function(a){return!e.isOperator||e.operatorItemType.indexOf(a[0])>-1?t("li",{key:a[0],class:[{curr:e.itemType===a[0]}],on:{click:function(t){e.handleSelectItemType(a[0])}}},[e._v(e._s(a[1])+"\n            ")]):e._e()})),e._v(" "),t("ul",{staticClass:"list"},e._l(e.itemDatas,function(a){return t("li",{key:a.id},[t("p",{staticClass:"item-name"},[e._v(e._s(a.itemName))]),e._v(" "),t("div",{staticClass:"item-detail"},[t("span",{staticClass:"item-price"},[e._v("￥"+e._s(a.salePrice))]),e._v(" "),t("zs-input-number",{class:[{"is-zero":0==a.itemsTimes}],attrs:{min:0,max:e.totalSelectItemId.indexOf(a.id)>-1?0:1e3,disabled:e.totalSelectItemId.indexOf(a.id)>-1},on:{click:function(t){e.handleItemTimesNotice(a)},change:function(t){e.handleItemTimesChange(a,t)}},model:{value:a.itemsTimes,callback:function(e){a.itemsTimes=e},expression:"item.itemsTimes"}})],1)])}))]),e._v(" "),t("div",{staticClass:"workorder-page-footer"},[e.itemSelectDatas.length>0?t("span",{staticClass:"total-price"},[e._v("合计"),t("i",[e._v("￥"+e._s(e.itemTotalPrice))])]):t("span",{staticClass:"notice"},[e._v("未选择服务项目")]),e._v(" "),t("p",{staticClass:"control",class:[{"is-disabled":0===e.itemSelectDatas.length}],on:{click:e.handleNext}},[e._v("\n            "+e._s(e.isOperator?"提交工单":"下一步"))])]),e._v(" "),t("zs-slide-page",{staticClass:"search-page",attrs:{homeIcon:!1},model:{value:e.searchPage,callback:function(a){e.searchPage=a},expression:"searchPage"}},[t("div",{staticClass:"search-page-input",slot:"slide-page-title"},[t("zs-input",{attrs:{preIcon:"search",placeholder:"请输入姓名、车牌、关键词"},on:{enter:function(a){e.selectMemberData(!1)}},model:{value:e.memberPara.keyWord,callback:function(a){e.memberPara.keyWord=a},expression:"memberPara.keyWord"}}),e._v(" "),t("span",{staticClass:"search-page-input-text",on:{click:function(a){e.selectMemberData(!1)}}},[e._v("搜索")])],1),e._v(" "),t("ul",{staticClass:"item-list"},[e.memberData.length>0?[e._l(e.memberData,function(a){return t("li",{key:a.recordId,staticClass:"list",on:{click:function(t){e.handSelectMemberData(a)}}},[t("div",{staticClass:"list-top"},[t("zs-icon",{attrs:{size:"16",icon:"user",text:a.realName||"&nbsp;"}}),e._v(" "),t("zs-icon",{attrs:{size:"16",icon:a.recordId?"member":"no-member",text:a.recordId?a.lvlName||"普通会员":"非会员"}}),e._v(" "),a.mobile?t("span",{staticClass:"list-div-mobile r"},[e._v(e._s(a.mobile))]):e._e()],1),e._v(" "),t("div",{staticClass:"list-bottom"},[t("zs-icon",{attrs:{size:"16",icon:"car2",text:a.carNumber}})],1)])}),e._v(" "),t("li",{staticClass:"show-more",class:[{"no-more":!e.hasNextPage}],on:{click:e.handleShowMore}},[e._v(e._s(e.hasNextPage?"查看更多":"已显示全部")+"\n                ")])]:t("li",{staticClass:"list-empty"},[e._v("暂无客户")])],2)]),e._v(" "),t("zs-slide-page",{attrs:{title:"开单"},on:{"go-home":e.handleGoHome},model:{value:e.nextPageVisible,callback:function(a){e.nextPageVisible=a},expression:"nextPageVisible"}},[t("div",{staticClass:"workorder-second-page"},[t("ul",{staticClass:"member-info"},[t("li",{staticClass:"member-info-car"},[t("span",{staticClass:"title"},[e._v("服务车辆")]),e._v(" "),t("div",{staticClass:"info info-car-number",class:[{"is-member":e.memberRecordId}]},[t("span",{staticClass:"number"},[e._v(e._s(e.finalData.carNumber))]),e._v(" "),t("div",{staticClass:"lvlname-wrap"},[e.finalData.carNumber?t("p",{staticClass:"lvlname"},[e._v(e._s(e.memberLvl))]):e._e()])])]),e._v(" "),!e.isOperator&&e.memberRecordId?t("li",{staticClass:"arrow-right check-member",on:{click:e.handleToMemberDetail}},[e._v("查看消费记录\n                ")]):e._e(),e._v(" "),t("li",{staticClass:"user-realname"},[t("span",{staticClass:"title"},[e._v("客户姓名")]),e._v(" "),t("p",{staticClass:"info"},[t("zs-input",{attrs:{icon:"circle-cross",placeholder:"请输入客户姓名"},model:{value:e.finalData.user.realName,callback:function(a){e.finalData.user.realName=a},expression:"finalData.user.realName"}})],1),e._v(" "),e.remarks?t("span",{staticClass:"user-remarks"},[e._v("（ "+e._s(e.remarks)+"）")]):e._e()]),e._v(" "),t("li",[t("span",{staticClass:"title"},[e._v("手机号")]),e._v(" "),t("p",{staticClass:"info"},[t("zs-input",{attrs:{icon:"circle-cross",maxlength:11,placeholder:"请输入手机号"},model:{value:e.finalData.mobile,callback:function(a){e.finalData.mobile=a},expression:"finalData.mobile"}})],1)])]),e._v(" "),t("div",{staticClass:"item-info"},[t("p",{staticClass:"title"},[e._v("服务项目")]),e._v(" "),t("ul",{staticClass:"item-list"},e._l(e.itemSelectDatas,function(a,s){return t("li",{key:a.id},[t("div",{staticClass:"item-p-1"},[t("span",{staticClass:"item-name"},[e._v(e._s(a.serviceItemName)),t("i",[e._v("X"+e._s(a.itemsTimes))])]),e._v(" "),t("span",{staticClass:"item-operator"},[e._v("￥"+e._s(parseFloat(a.salePrice).toFixed(2)))]),e._v(" "),a._hasCard?t("zs-switch",{staticClass:"item-switch",on:{change:function(a){e.handleToggleUseCard(s)}},model:{value:a._useCard,callback:function(e){a._useCard=e},expression:"item._useCard"}}):e._e()],1),e._v(" "),a.workerName||a._useCard?t("div",{staticClass:"item-p-2"},[t("span",{staticClass:"item-price"},[e._v(e._s(a.workerName))]),e._v(" "),a._hasCard?t("div",{staticClass:"use-card-info"},[t("p",{staticClass:"use-card-label",class:[{"use-card":a._useCard}]},[e._v("\n                                    "+e._s((a._useCard?"用卡":"不用卡")+"(剩余"+e.packageRemain[a.serviceItemId]+"次)")+"\n                                ")])]):e._e()]):e._e(),e._v(" "),e.couponsData.length>0?t("div",{staticClass:"item-p-3 arrow-right",on:{click:function(t){e.handlePopCoupon(a.itemType,s)}}},[t("span",{staticClass:"sub-title"},[e._v("卡券抵扣"),a.couponName?t("i",[e._v("("+e._s(a.couponName)+")")]):e._e()]),e._v(" "),t("span",{staticClass:"discount-price",class:[{gray:!a.couponName}]},[e._v(e._s(e.handleCouponShow(a,s)))])]):e._e(),e._v(" "),2==a.discountType||1==a.discountType&&a.discountNumber<10?t("div",{staticClass:"item-p-4"},[t("span",{staticClass:"sub-title"},[e._v("会员扣减")]),e._v(" "),t("span",{staticClass:"discount-price"},[e._v("-￥"+e._s(e.handleCalcDiscountPrice(a,s)))])]):e._e(),e._v(" "),t("div",{staticClass:"item-p-5"},[t("span",{staticClass:"sub-title"},[e._v("总金额")]),e._v(" "),t("span",{staticClass:"discount-price"},[e._v("￥"+e._s(e.handleCalcItemTotalPrice(a,s)))])])])})),e._v(" "),t("p",{staticClass:"item-total-price"},[e._v("项目费用"),t("i",[e._v("￥"+e._s(e.itemCalcTotalPrice))])])]),e._v(" "),t("ul",{staticClass:"deduct-info"},[t("li",[t("zs-icon",{staticClass:"label-icon",attrs:{icon:"附",size:"18","icon-dis":"8","icon-background":"#e75845",text:"附加费用"}}),e._v(" "),t("zs-input",{attrs:{icon:"circle-cross",type:"number",placeholder:"请输入附加费用"},model:{value:e.finalData.materialCost,callback:function(a){e.finalData.materialCost=a},expression:"finalData.materialCost"}})],1),e._v(" "),t("li",[t("zs-icon",{staticClass:"label-icon",attrs:{icon:"减",size:"18","icon-dis":"8","icon-background":"#2cc068",text:"商家扣减"}}),e._v(" "),t("zs-input",{attrs:{icon:"circle-cross",type:"number",placeholder:"请输入商家扣减"},model:{value:e.finalData.businessDeduct,callback:function(a){e.finalData.businessDeduct=a},expression:"finalData.businessDeduct"}})],1),e._v(" "),e.memberBalanceDeduct>0?t("li",{staticClass:"member-balance"},[t("div",{staticClass:"p-1"},[t("zs-icon",{staticClass:"label-icon",attrs:{icon:"会",size:"18","icon-dis":"8","icon-background":"#4b8dde",text:"会员余额支付"}}),e._v("\n                        - "+e._s(e.useBalance?Math.min(parseFloat(e.memberBalanceDeduct),parseFloat(e.totalPriceBeforeBalance||0)).toFixed(2):0)+"\n                        "),t("zs-switch",{model:{value:e.useBalance,callback:function(a){e.useBalance=a},expression:"useBalance"}})],1),e._v(" "),t("p",{staticClass:"p-2"},[e._v("(余额："+e._s(parseFloat(e.memberBalanceDeduct).toFixed(2))+")")])]):e._e(),e._v(" "),t("li",[t("span",{staticClass:"label-icon"},[e._v("备注")]),e._v(" "),t("zs-input",{attrs:{icon:"circle-cross",placeholder:"请输入工单备注"},model:{value:e.finalData.comment,callback:function(a){e.finalData.comment=a},expression:"finalData.comment"}})],1)]),e._v(" "),t("div",{staticClass:"workorder-page-footer"},[t("span",{staticClass:"total-price"},[e._v("合计"),t("i",[e._v("￥"+e._s(e.totalPrice))])]),e._v(" "),t("p",{staticClass:"control return-control",on:{click:function(a){e.nextPageVisible=!1}}},[e._v("上一步")]),e._v(" "),t("p",{staticClass:"control",on:{click:e.updateWorkOrder}},[e._v("保存工单")])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.couponSelectVisible,expression:"couponSelectVisible"}],staticClass:"coupon-modal",on:{click:function(a){e.couponSelectVisible=!1}}}),e._v(" "),t("div",{staticClass:"coupon-select-wrap",class:[{"coupon-show":e.couponSelectVisible}]},[t("ul",{staticClass:"coupon-list"},e._l(e.couponsItemData,function(a,s){return t("li",{key:a.id,staticClass:"coupons-item",on:{click:function(t){e.handleSelectCoupon(a.takeUuid)}}},[t("div",{staticClass:"coupons-price"},[t("span",{staticClass:"coupons-price-label"},[e._v("￥")]),e._v(e._s(a.coupon.cpMoney)+"\n                        "),t("p",{staticClass:"coupons-price-type"},[e._v("现金券")])]),e._v(" "),t("div",{staticClass:"coupons-detail"},[t("p",{staticClass:"coupons-name"},[e._v(e._s(a.coupon.cpName))]),e._v(" "),t("p",{staticClass:"coupons-date"},[e._v("\n                            "+e._s(a.useBeginDay.slice(0,10)+"到"+a.useEndDay.slice(0,10)))])]),e._v(" "),t("zs-icon",{staticClass:"coupons-checked",attrs:{icon:a.couponKey===e.itemSelectDatas[e.currItemIndex].couponKey?"check":"uncheck",size:"20"}})],1)}))])])],1)},staticRenderFns:[]}},354:function(e,a){},488:function(e,a,t){e.exports=t(85)},85:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=t(1),i=t(258),o=t.n(i),c=t(5),r=(t.n(c),t(3),t(4));s.a.use(r.a),new s.a({el:"#app",render:function(e){return e(o.a)}})}},[488]);