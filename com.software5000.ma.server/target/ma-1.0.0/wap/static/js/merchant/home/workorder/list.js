webpackJsonp([21],{182:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(2),i=s(12),r=s(26),n=(s.n(r),s(11)),o=s.n(n),c=s(18),l=s.n(c);t.default={components:{maFoot:o.a,pullMenu:l.a},data:function(){return{isLoading:!0,isOperator:!1,workOrderPayTypes:[],currTab:1,tabs:[{title:"待结算",count:0},{title:"未完工",count:0},{title:"已完成",count:0}],workOrders:[],startPage:1,pageSize:10,hasNextPage:!1,sTop:0,menuVisible:!1,startTime:"",endTime:"",payType:-1}},methods:{pageScroll:function(){var e=this;s.i(r.debounce)(300,function(){e.sTop=e.$refs.scrollEle.scrollTop})()},handleQuit:function(){var e=this;this.$confirm({type:"quit",message:"确定退出"}).then(function(){e.$ajax(e.$joggle.merchant.open.logout,{},!0,function(t,i){i.close(),"ZS011000"===t.code?(e.$message({type:"success",message:"退出成功"}),setTimeout(function(){s.i(a.d)("/wap/merchant/open/login.html")},1200)):e.$message({type:"error",message:t.msg})})}).catch(function(){})},calcItemsPrice:function(e){var t=0;return s.i(a.c)(e)?0:(e.forEach(function(e){t+=parseFloat(e.salePrice)}),t.toFixed(2))},handleTabChange:function(e){a.l.add({tab:e}),this.startPage=1,this.pageSize=10,3!=this.currTab&&(this.payType="",this.startTime="",this.endTime=""),this.$refs.scrollEle.scrollTop=0;var t=this.$loading();this.selectWorkOrder(function(){t.close()},t)},handleShowMore:function(){if(this.hasNextPage){this.pageSize=10;var e=this.$loading();this.selectWorkOrder(function(){e.close()},e,!0)}},handleEdit:function(e){var t=a.l.parse();t.pageSize=this.startPage*this.pageSize,a.l.add(t),s.i(a.d)("/wap/merchant/home/workorder/update.html",s.i(a.c)(e)?{}:{id:e})},handleCheck:function(e){var t=a.l.parse();t.pageSize=this.startPage*this.pageSize,t.payType=this.payType,t.startTime=this.startTime,t.endTime=this.endTime,t.sTop=this.sTop,a.l.add(t),s.i(a.d)("/wap/merchant/home/workorder/detail.html",{id:e})},handleFinish:function(e){var t=this;this.$ajax(this.$joggle.merchant.workorder.updateWorkOrderForFinish,{orderId:e},!0,function(s,a){"ZS011000"===s.code?t.handleCheck(e):(a.close(),t.$message({type:"error",message:s.msg}))})},handlePayTypeSelect:function(e){this.payType=e,this.menuVisible=!1,this.startPage=1;var t=this.$loading();this.selectWorkOrder(function(){t.close()},t)},handleTimeControl:function(e){if(-1===e)this.startTime=this.endTime="";else{var t=a.g.swapTime(this.startTime,this.endTime);this.startTime=t[0],this.endTime=t[1]}this.menuVisible=!1,this.startPage=1;var s=this.$loading();this.selectWorkOrder(function(){s.close()},s)},selectStateCount:function(e,t){var s=this;this.$ajax(this.$joggle.merchant.workorder.selectWorkOrderStateCount,{},t,function(t){"ZS011000"===t.code?s.isOperator?(s.$set(s.tabs[0],"count",t.data[1]||0),s.$set(s.tabs[1],"count",t.data[4]||0)):(s.$set(s.tabs[0],"count",t.data[3]||0),s.$set(s.tabs[1],"count",t.data[1]||0),3!=s.currTab&&s.$set(s.tabs[2],"count",t.data[4]||0)):s.$message({type:"error",message:t.msg}),e&&e()})},selectWorkOrder:function(e,t,i){var r=this;i?this.startPage++:this.startPage=1;var n=this.isOperator?["1","4"]:["3","1","4"];this.$ajax(this.$joggle.merchant.workorder.selectWorkOrderByPage,{state:n[this.currTab-1],startPage:this.startPage,pageSize:this.pageSize,startTime:s.i(a.c)(this.startTime)?"":this.startTime+" 00:00:00",endTime:s.i(a.c)(this.endTime)?"":this.endTime+" 23:59:59",payType:-1===this.payType?"":this.payType},t,function(t){"ZS011000"===t.code?(r.hasNextPage=t.data.hasNextPage,r.workOrders=i?r.workOrders.concat(t.data.list):t.data.list,3==r.currTab&&r.$set(r.tabs[2],"count",t.data.total||0)):r.$message({type:"error",message:t.msg}),e&&e(t)})},selectPayTypes:function(e,t){var s=this;this.$ajax(this.$joggle.mzscp.selectConstantTypes,{codeTypes:"WorkOrderPayType"},t,function(t){"ZS011000"===t.code?s.workOrderPayTypes=t.data.WorkOrderPayType||[]:s.$message({type:"error",message:t.msg}),e&&e()})}},mounted:function(){var e=this;this.currTab=a.l.parse().tab||1,this.pageSize=a.l.parse().pageSize||10,this.sTop=a.l.parse().sTop||0,3==this.currTab&&(this.payType=a.l.parse().payType,this.startTime=a.l.parse().startTime,this.endTime=a.l.parse().endTime);var t=this.$loading();s.i(i.a)(function(s){e.isOperator=!!s.mercharType&&s.mercharType.indexOf("operator")>-1,e.isOperator&&(e.$delete(e.tabs,0),e.currTab=3==e.currTab?2:e.currTab);var a=new Promise(function(s){e.selectStateCount(function(){s()},t)}),i=new Promise(function(s){e.selectWorkOrder(function(){s()},t)}),r=new Promise(function(s){e.selectPayTypes(function(){s()},t)});Promise.all([a,i,r]).then(function(){t.close(),e.isLoading=!1,e.pageSize>10&&(e.startPage=e.pageSize/10),setTimeout(function(){e.$refs.scrollEle.scrollTop=e.sTop},0)})})}}},257:function(e,t,s){s(370);var a=s(0)(s(182),s(296),null,null);e.exports=a.exports},296:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"scrollEle",staticClass:"workorder-page",on:{scroll:e.pageScroll}},[[s("zs-tab",{attrs:{tabs:e.tabs},on:{change:e.handleTabChange},model:{value:e.currTab,callback:function(t){e.currTab=t},expression:"currTab"}}),e._v(" "),s("pull-menu",{directives:[{name:"show",rawName:"v-show",value:3==e.currTab,expression:"currTab == 3"}],attrs:{p1:"时间筛选",p2:"付款方式"},model:{value:e.menuVisible,callback:function(t){e.menuVisible=t},expression:"menuVisible"}},[s("template",{slot:"p1"},[s("div",{staticClass:"create-time-select"},[s("label",{staticClass:"time-wrap",attrs:{for:"startTime"}},[s("span",[e._v(e._s(e.startTime||"开始日期"))]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.startTime,expression:"startTime"}],attrs:{type:"date",id:"startTime"},domProps:{value:e.startTime},on:{input:function(t){t.target.composing||(e.startTime=t.target.value)}}})]),e._v(" "),s("span",{staticClass:"time-wrap-sep"},[e._v("-")]),e._v(" "),s("label",{staticClass:"time-wrap",attrs:{for:"endTime"}},[s("span",[e._v(e._s(e.endTime||"结束日期"))]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.endTime,expression:"endTime"}],attrs:{type:"date",id:"endTime"},domProps:{value:e.endTime},on:{input:function(t){t.target.composing||(e.endTime=t.target.value)}}})])]),e._v(" "),s("ul",{staticClass:"create-time-btn"},[s("li",{on:{click:function(t){e.handleTimeControl(-1)}}},[e._v("清空")]),e._v(" "),s("li",{on:{click:e.handleTimeControl}},[e._v("确定")])])]),e._v(" "),s("ul",{staticClass:"pay-type-list",slot:"p2"},[s("li",{class:[{curr:-1==e.payType}],on:{click:function(t){e.handlePayTypeSelect(-1)}}},[e._v("不限")]),e._v(" "),e._l(e.workOrderPayTypes,function(t){return 3!=t[0]?s("li",{key:t[0],class:[{curr:e.payType==t[0]}],on:{click:function(s){e.handlePayTypeSelect(t[0])}}},[e._v(e._s(t[1])+"\n                ")]):e._e()})],2)],2),e._v(" "),s("ul",{staticClass:"item-list",class:[{"is-operator":e.isOperator,pt110:3==e.currTab}]},[e.workOrders.length>0?[e._l(e.workOrders,function(t){return s("li",{key:t.id,staticClass:"list",on:{click:function(s){e.handleCheck(t.id)}}},[s("div",{staticClass:"list-info"},[s("zs-icon",{staticClass:"car-number",attrs:{icon:"car",size:"20","icon-dis":"10",text:t.carNumber}}),e._v(" "),s("zs-icon",{staticClass:"member-label",class:[{"is-member":t.recordId}],attrs:{icon:t.recordId?"member":"no-member",size:"16","icon-dis":"4",text:t.recordId?t.lvlName||"普通会员":"非会员"}}),e._v(" "),4==t.state?s("span",{staticClass:"pay-time"},[e._v(e._s(t.payTime?t.payTime.slice(0,10):""))]):e._e()],1),e._v(" "),s("ul",{staticClass:"items"},[e._l(t.workOrderDetails,function(t,a){return a<3?s("li",[e._v("\n                            "+e._s(t.serviceItemName+(e.isOperator?"":" * "+t.itemsTimes))+"\n                            "),s("span",[e._v(e._s(e.isOperator?"x "+t.itemsTimes:t.workerName||""))])]):e._e()}),e._v(" "),t.workOrderDetails.length>3?s("li",[e._v("···")]):e._e()],2),e._v(" "),e.isOperator?e._e():s("div",{staticClass:"control"},[3==t.state?s("zs-button",{attrs:{type:"primary"},on:{click:function(s){e.handleCheck(t.id)}}},[e._v("\n                            去结算\n                        ")]):e._e(),e._v(" "),1==t.state?[e.isOperator?e._e():s("zs-button",{attrs:{type:"success"},on:{click:function(s){s.stopPropagation(),e.handleEdit(t.id)}}},[e._v("\n                                修改工单\n                            ")]),e._v(" "),s("zs-button",{attrs:{type:"primary"},on:{click:function(s){s.stopPropagation(),e.handleFinish(t.id)}}},[e._v("施工完成")])]:e._e(),e._v(" "),4==t.state?[s("zs-icon",{attrs:{icon:["","cash-pay","wechat-pay"][t.payType],text:["","现金收款","微信收款"][t.payType],"icon-dis":"6",size:"17"}}),e._v(" "),s("span",{staticClass:"total-price"},[e._v("￥"+e._s(t.totalPrice))])]:e._e()],2),e._v(" "),e.isOperator&&4==t.state?s("div",{staticClass:"control"},[s("span",{staticClass:"operator-detail"},[e._v("项目金额"),s("i",[e._v(e._s(e.calcItemsPrice(t.workOrderDetails)))])])]):e._e()])}),e._v(" "),s("li",{staticClass:"show-more",class:[{"no-more":!e.hasNextPage}],on:{click:e.handleShowMore}},[e._v(e._s(e.hasNextPage?"查看更多":"已显示全部")+"\n                ")])]:s("li",{staticClass:"list-empty"},[e._v("暂无工单")])],2),e._v(" "),e.isOperator?s("ul",{staticClass:"operator-menu"},[s("li",{on:{click:e.handleQuit}},[s("p",{staticClass:"p1"},[e._v("退出")])]),e._v(" "),s("li",{on:{click:function(t){e.handleEdit("")}}},[s("p",{staticClass:"p2"},[e._v("创建工单")])])]):[s("div",{staticClass:"create-label",on:{click:function(t){e.handleEdit("")}}}),e._v(" "),s("ma-foot",{attrs:{current:1}})]]],2)},staticRenderFns:[]}},370:function(e,t){},487:function(e,t,s){e.exports=s(84)},84:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s(1),i=s(257),r=s.n(i),n=s(5),o=(s.n(n),s(3),s(4));a.a.use(o.a),new a.a({el:"#app",render:function(e){return e(r.a)}})}},[487]);