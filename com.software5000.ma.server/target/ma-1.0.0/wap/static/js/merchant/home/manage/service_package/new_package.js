webpackJsonp([33],{165:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=t(2),i=t(6),c=t.n(i);a.default={components:{maHead:c.a},props:{},data:function(){return{isLoading:!1,packageBaseData:{packageName:"",validTerm:"",originalPrice:"",salePrice:"",instructions:"",packageAndItems:[]},chooseItems:!1,itemTypes:[],itemType:"",itemDatas:[],itemTempDatas:[],itemSelectDatas:[],selectDatas:[],itemTotalPrice:0,id:0}},computed:{},watch:{},methods:{insertNewPackage:function(){var e=this;this.packageBaseData.salePrice=parseFloat(this.packageBaseData.salePrice).toFixed(2),this.packageBaseData.originalPrice=parseFloat(this.packageBaseData.originalPrice).toFixed(2),this.$ajax(this.$joggle.merchant.businessPackage.insertBusinessPackage,this.packageBaseData,!0,function(a,i){i.close(),"ZS011000"===a.code?(e.$message({type:"success",message:a.msg,duration:1200}),t.i(s.d)("/wap/merchant/home/manage/service_package/package_list.html")):e.$message({type:"error",message:a.msg})})},updateMessage:function(){var e=this,a=this.packageBaseData;a.id=this.id,a.salePrice&&(a.salePrice=parseFloat(a.salePrice).toFixed(2),a.originalPrice=parseFloat(a.originalPrice).toFixed(2)),this.$ajax(this.$joggle.merchant.businessPackage.updateBusinessPackage,a,!0,function(a,i){i.close(),"ZS011000"===a.code?(e.$message({type:"success",message:a.msg,duration:1200}),t.i(s.d)("/wap/merchant/home/manage/service_package/package_list.html")):e.$message({type:"error",message:a.msg})})},selectItemType:function(e,a){var t=this;this.$ajax(this.$joggle.mzscp.selectConstantTypes,{codeTypes:"ServiceItemType"},a,function(a){if("ZS011000"===a.code){var s=a.data.ServiceItemType;s.unshift(["","全部"]),t.itemTypes=s}else t.$message({type:"error",message:a.msg,duration:1200});e&&e()})},selectServiceItem:function(e,a){var t=this;this.$ajax(this.$joggle.merchant.workorder.selectServiceItem,{itemType:this.itemType},a,function(a){"ZS011000"===a.code?t.itemDatas=a.data:t.$message({type:"error",message:a.msg}),e&&e()})},handleCalcTotalPrice:function(){var e=this;this.$nextTick(function(){for(var a=0;a<e.itemSelectDatas.length;a++){0===e.itemSelectDatas[a].itemsTimes&&e.$delete(e.itemSelectDatas,a)}var i=0,c=[];e.itemSelectDatas.forEach(function(e){i+=e.itemsTimes*e.salePrice,c.push({useTimes:e.itemsTimes,serviceItemId:e.id})}),e.packageBaseData.packageAndItems=c,e.packageBaseData.originalPrice=parseFloat(t.i(s.c)(i)?0:i).toFixed(2)})},handleSelectItemShow:function(){var e=this;this.itemTempDatas=t.i(s.o)(this.itemSelectDatas),this.itemDatas.forEach(function(a){for(var t=!0,s=0;s<e.itemSelectDatas.length;s++)if(e.itemSelectDatas[s].id===a.id){e.$set(a,"itemsTimes",e.itemSelectDatas[s].itemsTimes),t=!1;break}t&&e.$set(a,"itemsTimes",0)}),this.chooseItems=!0},handleItemTimes:function(e,a){for(var t=this,s=!0,i=0;i<this.itemTempDatas.length;i++){if(t.itemTempDatas[i].id==e.id){0===a?t.$delete(t.itemTempDatas,i):t.itemTempDatas[i].itemsTimes=a,s=!1;break}}s&&this.itemTempDatas.push(e)},handleSelectItemType:function(e){this.itemType=e;var a=this.$loading();this.selectServiceItem(function(){a.close()},a)},handleInsertJudge:function(){var e=/^\d+(\.\d+)?$/,a="";if(t.i(s.c)(this.packageBaseData.packageName)?a="请输入套餐名称":t.i(s.c)(this.packageBaseData.validTerm)?a="请输入套餐有效期":t.i(s.c)(this.packageBaseData.salePrice)?a="请输入套餐售价":e.test(this.packageBaseData.salePrice)?t.i(s.c)(this.packageBaseData.packageAndItems)&&(a="请选择套餐项目"):a="请输入正确的套餐售价",""!=a)return this.$message({type:"error",duration:1e3,message:a}),!1;t.i(s.c)(this.id)?this.insertNewPackage():this.updateMessage()},handleSelectSure:function(){this.itemTempDatas.length>0&&(this.itemSelectDatas=t.i(s.o)(this.itemTempDatas),this.handleCalcTotalPrice(),this.chooseItems=!1)},handleUpdataForm:function(e){var a=this;this.packageBaseData.packageName=e.packageName,this.packageBaseData.validTerm=e.validTerm,this.packageBaseData.salePrice=e.salePrice,this.packageBaseData.instructions=e.instructions;for(var i=0;i<e.packageAndItems.length;i++){var c=e.packageAndItems[i];c.serviceItem.itemsTimes=c.useTimes,a.itemSelectDatas.push(c.serviceItem)}var n=0,l=[];this.itemSelectDatas.forEach(function(e){n+=e.itemsTimes*e.salePrice,l.push({useTimes:e.itemsTimes,serviceItemId:e.id})}),this.packageBaseData.packageAndItems=l,this.packageBaseData.originalPrice=parseFloat(t.i(s.c)(n)?0:n).toFixed(2)},handleGoHome:function(){t.i(s.d)("/wap/merchant/home/manage/index.html")}},created:function(){var e=this;this.id=t.i(s.a)("id")?t.i(s.a)("id"):"",t.i(s.c)(this.id)||this.$ajax(this.$joggle.merchant.businessPackage.selectBusinessPackageById,{businessPackageId:this.id},!0,function(a,t){if(t.close(),"ZS011000"===a.code){var s=a.data;e.handleUpdataForm(s)}else e.$message({type:"error",message:a.msg})});var a=this.$loading(),i=new Promise(function(t){e.selectItemType(function(){t()},a)}),c=new Promise(function(t){e.selectServiceItem(function(){t()},a)});Promise.all([i,c]).then(function(){a.close()})},mounted:function(){}}},240:function(e,a,t){t(394);var s=t(0)(t(165),t(323),null,null);e.exports=s.exports},323:function(e,a){e.exports={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"newPackage-page"},[t("ma-head",{on:{"home-click":e.handleGoHome}},[e._v(e._s(e.id?"修改套餐":"新建套餐"))]),e._v(" "),t("div",{staticClass:"new-body1"},[t("ul",[t("li",[e._m(0),e._v(" "),t("zs-input",{attrs:{maxlength:10,placeholder:"请输入套餐名称"},model:{value:e.packageBaseData.packageName,callback:function(a){e.packageBaseData.packageName=a},expression:"packageBaseData.packageName"}}),e._v(" "),t("span",{staticClass:"li-length"},[e._v(e._s(e.packageBaseData.packageName.length)+"/10")])],1),e._v(" "),t("li",{staticClass:"row-select"},[e._m(1),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.packageBaseData.validTerm,expression:"packageBaseData.validTerm"}],staticClass:"li-select",attrs:{placeholder:"请选择有效期"},on:{change:function(a){var t=Array.prototype.filter.call(a.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.packageBaseData.validTerm=a.target.multiple?t:t[0]}}},[t("option",{attrs:{value:"",label:"请选择有效期"}},[e._v("请选择有效期")]),e._v(" "),t("option",{attrs:{label:"1年"},domProps:{value:1}},[e._v("1年")]),e._v(" "),t("option",{attrs:{label:"2年"},domProps:{value:2}},[e._v("2年")]),e._v(" "),t("option",{attrs:{label:"3年"},domProps:{value:3}},[e._v("3年")]),e._v(" "),t("option",{attrs:{label:"永久"},domProps:{value:0}},[e._v("永久")])]),e._v(" "),t("zs-icon",{staticClass:"li-deal",attrs:{icon:"arrow-right",size:"10"}})],1)])]),e._v(" "),t("div",{staticClass:"new-body2"},[t("div",{staticClass:"title"},[e._v("套餐项目")]),e._v(" "),t("div",{staticClass:"content"},[t("ul",e._l(e.itemSelectDatas,function(a,s){return t("li",{key:a.id},[t("p",{staticClass:"li-h3"},[e._v(e._s(a.itemName))]),e._v(" "),t("div",{staticClass:"li-price"},[t("em",[e._v("￥"+e._s(a.salePrice))]),e._v(" "),t("zs-input-number",{staticClass:"li-number",attrs:{min:0},on:{change:e.handleCalcTotalPrice},model:{value:a.itemsTimes,callback:function(e){a.itemsTimes=e},expression:"it.itemsTimes"}})],1)])})),e._v(" "),t("div",{staticClass:"money-total"},[e._v("项目总金额"),t("em",[e._v("￥"+e._s(e.packageBaseData.originalPrice))])]),e._v(" "),t("div",{staticClass:"add-more",on:{click:e.handleSelectItemShow}},[t("zs-icon",{attrs:{icon:"ten-cross",size:"16",text:"添加新项目"}})],1)])]),e._v(" "),t("div",{staticClass:"new-body3"},[t("div",{staticClass:"row"},[e._m(2),e._v(" "),t("zs-input",{attrs:{placeholder:"请输入套餐售价"},model:{value:e.packageBaseData.salePrice,callback:function(a){e.packageBaseData.salePrice=a},expression:"packageBaseData.salePrice"}})],1),e._v(" "),t("div",{staticClass:"row-textarea"},[t("div",{staticClass:"row-h4"},[e._v("使用说明")]),e._v(" "),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.packageBaseData.instructions,expression:"packageBaseData.instructions"}],attrs:{placeholder:"请输入使用说明"},domProps:{value:e.packageBaseData.instructions},on:{input:function(a){a.target.composing||(e.packageBaseData.instructions=a.target.value)}}})])]),e._v(" "),t("div",{staticClass:"new-bottom"},[t("zs-button",{staticClass:"btn-click",attrs:{type:"primary"},on:{click:e.handleInsertJudge}},[e._v("提交")])],1),e._v(" "),t("zs-slide-page",{staticClass:"PackagePage",attrs:{title:"选择项目"},on:{"go-home":e.handleGoHome},model:{value:e.chooseItems,callback:function(a){e.chooseItems=a},expression:"chooseItems"}},[t("div",{staticClass:"item-select"},[t("ul",{staticClass:"menu"},e._l(e.itemTypes,function(a,s){return t("li",{key:s,class:[{curr:e.itemType===a[0]}],on:{click:function(t){e.handleSelectItemType(a[0])}}},[e._v(e._s(a[1])+"\n                ")])})),e._v(" "),t("ul",{staticClass:"list"},e._l(e.itemDatas,function(a,s){return t("li",{key:a.id},[t("p",{staticClass:"li-h3"},[e._v(e._s(a.itemName))]),e._v(" "),t("div",{staticClass:"li-price"},[t("em",[e._v("￥"+e._s(a.salePrice))]),e._v(" "),t("zs-input-number",{staticClass:"li-number",attrs:{min:0},on:{change:function(t){e.handleItemTimes(a,t)}},model:{value:a.itemsTimes,callback:function(e){a.itemsTimes=e},expression:"it.itemsTimes"}})],1)])})),e._v(" "),t("div",{staticClass:"new-bottom"},[t("zs-button",{class:0==e.itemTempDatas.length?"btn-click-bg":"btn-click",attrs:{type:"primary"},on:{click:e.handleSelectSure}},[e._v("确定\n                ")])],1)])])],1)},staticRenderFns:[function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"li-title"},[t("em",[e._v("*")]),e._v(" 套餐名称")])},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"li-title"},[t("em",[e._v("*")]),e._v(" 套餐有效期")])},function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"row-h3"},[t("em",[e._v("*")]),e._v(" 套餐售价")])}]}},394:function(e,a){},471:function(e,a,t){e.exports=t(68)},68:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=t(1),i=t(240),c=t.n(i),n=t(5),l=(t.n(n),t(3),t(4));s.a.use(l.a),new s.a({el:"#app",render:function(e){return e(c.a)}})}},[471]);